/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){require(["jquery","global","constants","crypto","lz-string","popup-utils","justgage","backup-connector","licensing-utils","backup-utils","jquery-ui","bootstrap-modal","bootstrap-tab"],function(jQuery,$G,$C,CryptoJS,LZString,PopupUtils,JustGage,BackupConnector,$LicUtils,$BackupUtils){"use strict";var chrome=$G.chrome,$=($G.window,jQuery.noConflict());PopupUtils.newDebugger("ER");$(function(){chrome.storage.session.getBytesInUse(function(size){$("#sessionPercent").text((size/chrome.storage.session.QUOTA_BYTES*100).toFixed(2))}),PopupUtils.getConfigParameterLocal([PopupUtils.StorageParamNameClientName,PopupUtils.StorageParamNameBackupsLocalStorage],function(err,params){var deobfuscate=function(msg,secret){var bytes=CryptoJS.AES.decrypt(msg,secret);return bytes.toString(CryptoJS.enc.Utf8)},backupLogins=function(secret,callback){secret=secret||chrome.runtime.id,chrome.storage.local.get(["accounts","orgs"],function(params){try{for(var accounts=params.accounts,orgs=params.orgs,i=0;i<accounts.length;i++){var tmp=accounts[i].p;accounts[i].p=deobfuscate(tmp,secret),accounts[i].p||(accounts[i].p=tmp)}for(var i=0;i<orgs.length;i++)orgs[i].ql=JSON.parse(orgs[i].ql);var result={accounts:accounts,orgs:orgs},blob=new Blob([JSON.stringify(result,null,2)],{type:"text/json"}),url=URL.createObjectURL(blob);chrome.downloads.download({url:url,saveAs:!0,filename:"backup.json"},function(downloadId){})}catch(ex){return callback&&callback("Invalid secret: "+ex)}})},extractAutoBackup=function(index,secret,callback){secret=secret||chrome.runtime.id,index=index||0;try{var backups=params[PopupUtils.StorageParamNameBackupsLocalStorage]||[];if(index<1||index>backups.length)throw new Error("there are only "+backups.length+" backups");var backup=backups[backups.length-index];backup.body=JSON.parse(LZString.decompressFromEncodedURIComponent(backup.body));for(var ai=0;ai<backup.body.accounts.length;ai++)backup.body.accounts[ai].p=deobfuscate(backup.body.accounts[ai].p,secret);var imp={accounts:backup.body.accounts,orgs:backup.body.orgs},dt=new Date(backup.createdDate);return dt=dt.toISOString().replace(/:/gi,"_"),PopupUtils.triggerDownloadTextFile("backup_"+dt+".json",JSON.stringify(imp,null,2)),callback&&callback()}catch(ex){return callback&&callback(ex)}};PopupUtils.getLocalCode(function(uc){$("#txtClientID").val(uc)});var clientName=params[PopupUtils.StorageParamNameClientName];$("#txtClientName").val(clientName),$("#btnDownloadBackup").click(function(){return backupLogins($("#txtSecret").val().trim(),function(err){if(err)return alert(err)})});var inspectStorage=function(){chrome.storage.local.get(null,function(params){params.accounts=params.accounts.length,params.orgs=params.orgs.length,params.refresh_tokens="Size("+(params.refresh_tokens||"").length+")",params.pluginStorage="Size("+(params.pluginStorage||"").length+")",params.bugQueue="Size("+(params.bugQueue||"").length+")",params.ajxc="Size("+(params.ajxc||"").length+")",params.apiCounterDetails="Size("+JSON.stringify(params.apiCounterDetails||"").length+")",params.backups=params.backups.length,params["gg-auth-tk"]=params["gg-auth-tk"]?"<obfuscated>":null,params.acgrlst="Size("+JSON.stringify(params.acgrlst||"").length+")",params.p=params.p?"<obfuscated>":null,$("#txtInspection").text(JSON.stringify(params,null,2))})},autoBackupList=params[PopupUtils.StorageParamNameBackupsLocalStorage]||[];$("#autoBackupsCount").text(autoBackupList.length),$("#txtAutoBackupIndex").attr("max",autoBackupList.length),autoBackupList.length?$("#btnDownloadAutoBackup").click(function(){return extractAutoBackup($("#txtAutoBackupIndex").val(),$("#txtSecretAutoBackup").val(),function(err){if(err)return alert(err)})}):$("#btnDownloadAutoBackup").attr("disabled",!0),$("#btnInspectStorage").click(function(){return inspectStorage()})})})}),global.true=exports}({},function(){return this}());