/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){require(["jquery","global","constants","crypto","lz-string","popup-utils","licensing-utils","jquery-ui","bootstrap-colorpicker","bootstrap-modal","bootstrap-tab","bootstrap-collapse"],function(jQuery,$G,$C,CryptoJS,LZString,PopupUtils,$LicUtils){"use strict";var chrome=$G.chrome,window=$G.window,debug=PopupUtils.newDebugger("Popup"),_sponsorsRetrieved=!1;window&&window._gaq&&window._gaq.push(["_trackPageview"]),jQuery(function(){function resetFormatting(v){return $("<span/>").html($("<span/>").text(v).html().replace(/\[_b_\]/gi,"<b>").replace(/\[_\/b_\]/gi,"</b>")).html()}PopupUtils.handleCSSImageReferences();var $=jQuery.noConflict();PopupUtils.getConfigParameterLocal([PopupUtils.StorageParamNameBetaFeatures],function(err,params){params&&params[PopupUtils.StorageParamNameBetaFeatures]&&params[PopupUtils.StorageParamNameBetaFeatures].DARK_MODE||$("body").removeClass("bnsn-dark")}),$("i18n").each(function(){var elem=$(this),text=chrome.i18n.getMessage(elem.html()),parentAttribute=elem.attr("parent-attribute"),previousAttribute=elem.attr("previous-attribute");parentAttribute||previousAttribute?parentAttribute?(elem.parent().attr(parentAttribute,text),elem.remove()):previousAttribute&&(elem.prev().attr(previousAttribute,text),elem.remove()):elem.replaceWith(document.createTextNode(text))});var _storedSortedAccountsPerGroup,_storedParamsAccounts=[],_storedParamsOrgs={},_storedPassPhrase=null,_storedOrderedGroups=null,_defaultGroupName="Default",_otherValue=chrome.i18n.getMessage("popup_other_account_group")||"-- New Group --",_activeOrgsList=[],_shortcuts={},_popupInitStatus={},_isOSX=PopupUtils.isOSX(),_showAlertChangeLog=!1,_pinConfiguration=null,_apiLevel=null,_filterFavoriteLogins=!1,_actionsCounterLimitHit=!1,_sortOrgsByName=!0,accountListAccordion=$("#accountListAccordion"),form=$("#newForm"),handleLoadingMessage=function(msg){$("#loadingBox").find(".modal-body p").html(msg),$("#loadingBox").modal({keyboard:!1,backdrop:"static"}).modal(msg?"show":"hide")},filterAccountList=function(inputId,containerId){var searchVal=$("#"+inputId).val().toLowerCase();$("#"+containerId).find(".ui-account-item-li").each(function(index){var collapsibleContainer=$(this).closest(".ui-account-group-container");!searchVal||$(this).find(".ui-account-username").text().toLowerCase().indexOf(searchVal)>=0||$(this).find(".ui-account-name").text().toLowerCase().indexOf(searchVal)>=0?($(this).show(),collapsibleContainer.show(),searchVal&&(collapsibleContainer.find("a.ui-collasped-title").attr("aria-expanded",!0),collapsibleContainer.find(".ui-collapsible-body").parent().removeClass("in").addClass("in"),collapsibleContainer.find("span.ui-collapsible-caret").removeClass("glyphicon-triangle-right").addClass("glyphicon-triangle-bottom"),PopupUtils.storeGroupCollaspedStatus(collapsibleContainer.find("a.ui-collasped-title").text(),!1))):($(this).hide(),0===collapsibleContainer.find(".ui-account-item-li:visible").length&&collapsibleContainer.hide())})},disableInterface=function(msg){$(".ui-footer").hide(),$("#container").html('<p style="margin-top:40px" class="alert alert-danger"><strong>'+chrome.i18n.getMessage("general_err_modal_title")+"</strong> "+msg+"</p>")},filterOrgsList=function(inputId,containerId){var searchVal=$("#"+inputId).val().toLowerCase();$("#"+containerId).find(".list-group-item").each(function(index){!searchVal||$(this).find(".ui-server-label").text().toLowerCase().indexOf(searchVal)>=0||$(this).find(".ui-server-label").attr("data-oid").toLowerCase().indexOf(searchVal)>=0?$(this).show():$(this).hide()})},populateCachedAccountDataFromItem=function(item){form.find("#newGroup").val(item.g),form.find("#groupName").val(item.g).trigger("change"),form.find("#username").val(item.u);var password=item.p;if(password)if(_storedPassPhrase)password=PopupUtils.decryptText(password,_storedPassPhrase);else{var tmp=password;password=PopupUtils.deobfuscate(password),password||(password=tmp)}_storedPassPhrase&&password?(form.find("#password").attr("type","password").val(item.p).hide(),form.find("#passwordMasked").val(Math.random()).show()):(form.find("#password").attr("type","password").val(password).show(),form.find("#passwordMasked").hide()),form.find("#sync").prop("checked",!!item.s),form.find("#tokenLogin").prop("checked",!!item.lt),form.find("#oauthLogin").prop("checked",!!item.lo),form.find("#name").val(item.n),form.find("#token").val(item.t),item.r||(item.r="0"),!Number.isInteger(parseInt(item.r))&&PopupUtils.StandardLoginURLs.indexOf(item.r)>=0&&(item.r=PopupUtils.StandardLoginURLs.indexOf(item.r)),form.find("#url").val(item.r),form.find("#customUrl").val(Number.isInteger(parseInt(item.r))?PopupUtils.StandardLoginURLs[parseInt(item.r)]:item.r),Number.isInteger(parseInt(item.r))||(form.find("#url").val(""),form.find("#url").trigger("change")),item.lp||(item.lp="2"),!Number.isInteger(parseInt(item.lp))&&PopupUtils.StandardLandingPages.indexOf(item.lp)>=0&&(item.lp=PopupUtils.StandardLandingPages.indexOf(item.lp)),form.find("#landingPage").val(item.lp),form.find("#customLandingPage").val(Number.isInteger(parseInt(item.lp))?PopupUtils.StandardLandingPages[parseInt(item.lp)]:item.lp),Number.isInteger(parseInt(item.lp))||(form.find("#landingPage").val(""),form.find("#landingPage").trigger("change"))},createServerParamsBox=function(oid,serverName,editOrgId,callback){for(var server={},i=0;i<_storedParamsOrgs.length;i++){var isMyDomain=PopupUtils.isMyDomain(serverName);if(isMyDomain&&serverName===_storedParamsOrgs[i].n||_storedParamsOrgs[i].oid===oid){server=_storedParamsOrgs[i];break}}var tmpOid=oid,tmpQuickLinks=JSON.parse(server.ql||"[]"),modal=$("#serverParamsBox");modal.find(".modal-title").text(serverName),modal.find("#serverParams").find("#oid").show().text(oid||""),modal.find("#serverParams").find("#orgIdTxt").val(oid).hide().on("change",function(){tmpOid=$(this).val()}),modal.find("#orgDetails").show(),modal.find("#quickLinks").hide(),modal.find("#btnQuickLinks").removeAttr("disabled").removeClass("btn-primary"),modal.find("#btnDetails").attr("disabled",!0).addClass("btn-primary"),modal.find("#btnQuickLinks").unbind("click").click(function(){modal.find("#quickLinks").show(),modal.find("#orgDetails").hide(),modal.find("#btnQuickLinks").blur().attr("disabled",!0).addClass("btn-primary"),modal.find("#btnDetails").blur().removeAttr("disabled").removeClass("btn-primary")}),modal.find("#btnDetails").unbind("click").click(function(){modal.find("#quickLinks").hide(),modal.find("#orgDetails").show(),modal.find("#btnQuickLinks").blur().removeAttr("disabled").removeClass("btn-primary"),modal.find("#btnDetails").blur().attr("disabled",!0).addClass("btn-primary")}),editOrgId?(modal.find("#cancelEditing").unbind("click").hide().on("click",function(){return!!editOrgId&&(modal.find("#cancelEditing").hide(),modal.find("#doEditing").show(),modal.find("#serverParams").find("#oid").show(),modal.find("#serverParams").find("#orgIdTxt").hide().val(oid),void(tmpOid=oid))}),modal.find("#doEditing").unbind("click").show().on("click",function(){return!!editOrgId&&(modal.find("#cancelEditing").show(),modal.find("#doEditing").hide(),modal.find("#serverParams").find("#oid").hide(),modal.find("#serverParams").find("#orgIdTxt").show().val(oid),void(tmpOid=oid))})):(modal.find("#cancelEditing").hide(),modal.find("#doEditing").hide()),modal.find("#serverParams").find("#serverLabel").val(server.l||""),modal.find("#serverParams .ui-color-picker").colorpicker({format:"hex"}).colorpicker("setValue",server.c||""),modal.find(".ui-default-org-color").unbind("click").on("click",function(){var defaultColor=$(this).attr("data-color");modal.find("#serverParams .ui-color-picker").colorpicker({format:"hex"}).colorpicker("setValue",defaultColor)});var qlContainer=modal.find("#quickLinksList"),drawQuickLinks=function(){qlContainer.empty(),tmpQuickLinks=PopupUtils.mergeAndSortQuickLinks(tmpQuickLinks);var lbl_dblClickToEdit=chrome.i18n.getMessage("popup_quicklink_dblclicktoedit"),lbl_deleteQuickLink=chrome.i18n.getMessage("popup_quicklink_deletequicklink");for(var qi in tmpQuickLinks){var ql=tmpQuickLinks[qi],item=$('<div class="row ui-quicklink-row"><div class="col-xs-5 no-selection" ><small title="'+lbl_dblClickToEdit+'" data-index="'+qi+'" class="form-control-static ui-quicklink-label mouse-pointer">'+PopupUtils.htmlDecode(ql.l)+'</small></div><div class="col-xs-6 no-selection ellipsis"><small title="'+lbl_dblClickToEdit+'" data-index="'+qi+'" class="form-control-static nowrap ui-quicklink-url mouse-pointer" title="'+ql.p+'">'+PopupUtils.htmlDecode(ql.p)+'</small></div><div class="col-xs-1 "><span data-index="'+qi+'" class="ui-delete-link fa fa-times mouse-pointer" title="'+lbl_deleteQuickLink+'"></span></div></div>');qlContainer.append(item),item.find(".ui-delete-link").click(function(){tmpQuickLinks.splice($(this).attr("data-index"),1),drawQuickLinks()}),item.find(".ui-quicklink-label,.ui-quicklink-url").dblclick(function(){var qindex=$(this).attr("data-index"),qitem=tmpQuickLinks[qindex];modal.find("#newQuickLinkLabel").val(qitem.l),modal.find("#newQuickLinkPath").val(qitem.p),tmpQuickLinks.splice(qindex,1),drawQuickLinks()})}};drawQuickLinks(),modal.find("#newQuickLinkLabel").val(""),modal.find("#newQuickLinkPath").val(""),modal.find("#btnAddQuickLink").unbind("click").click(function(){var ql={l:modal.find("#newQuickLinkLabel").val(),p:modal.find("#newQuickLinkPath").val()};return ql.l&&ql.p?(tmpQuickLinks.push(ql),drawQuickLinks(),modal.find("#newQuickLinkLabel").val(""),void modal.find("#newQuickLinkPath").val("")):handleError(chrome.i18n.getMessage("popup_quicklink_mandatoryFields"))});var _loadedImportFileQL="";return modal.find("#inputImportQuickLinks").val("").unbind("change").change(function(evt){var input=evt.target;if(_loadedImportFileQL=null,input.files&&input.files.length){var reader=new FileReader;reader.onload=function(){_loadedImportFileQL=reader.result},reader.readAsText(input.files[0])}}),modal.find("#btnImportQuickLinks").unbind("click").click(function(){if(modal.find("#inputImportQuickLinks").val(""),!_loadedImportFileQL)return handleError(chrome.i18n.getMessage("popup_quicklink_invalidfilecontent_empty"));var parsed=null;try{parsed=JSON.parse(_loadedImportFileQL)}catch(ex){return handleError(chrome.i18n.getMessage("popup_quicklink_invalidfilecontent_invalidjson"))}if(Array.isArray(parsed)!==!0)return handleError(chrome.i18n.getMessage("popup_quicklink_invalidfilecontent_noarray"));for(var qi=0;qi<parsed.length;qi++)if(!parsed[qi].l||!parsed[qi].p)return handleError(chrome.i18n.getMessage("popup_quicklink_invalidelement")+" ("+(qi+1)+")");tmpQuickLinks.splice(0,tmpQuickLinks.length);for(var qi=0;qi<parsed.length;qi++)tmpQuickLinks.push(parsed[qi]);drawQuickLinks(),modal.find("#btnShowIMportExportQuickLinks").trigger("click")}),modal.find("#btnExportQuickLinks").unbind("click").click(function(){PopupUtils.triggerDownloadTextFile("quicklinks.json","text/json",JSON.stringify(tmpQuickLinks,null,2))}),modal.find("#btnShowIMportExportQuickLinks").unbind("click").click(function(){$("#formImportExportQuickLinks").toggle("fast"),$("#quickLinksList").toggle("fast"),$("#formInsertQuickLinks").toggle("fast")}),modal.find("#btnGetUrlFromTab").unbind("click").click(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){if(tabs.length){var url=tabs[0].url;url=url.split("://")[1]||"";var i=url.indexOf("/")||0;url=url.substring(i,url.length),modal.find("#newQuickLinkPath").val(url)}})}),modal.find(".ui-ok").unbind("click").click(function(){var tmp={n:serverName,oid:tmpOid||"",l:modal.find(".modal-body").find("#serverLabel").val(),c:modal.find(".modal-body").find("#iconColor").val(),ql:JSON.stringify(tmpQuickLinks)};if(!tmp||!tmp.oid)return handleError(new Error(chrome.i18n.getMessage("popup_org_invalidorgid")),function(){});var currentOrgId=server?server.oid:null,newOrgId=tmp.oid;server&&server.oid?(server.n=(tmp.n||"").toUpperCase(),server.oid=tmp.oid,server.l=tmp.l,server.c=tmp.c,server.ql=tmp.ql,server.d=(new Date).getTime()):(server=tmp,server.d=(new Date).getTime(),_storedParamsOrgs.push(server)),debug.log("Org ID changed from ",currentOrgId,"to",newOrgId),currentOrgId&&newOrgId!==currentOrgId&&PopupUtils.switchOrgRelatedLocalData({oldOrgId:currentOrgId,newOrgId:newOrgId},function(err){err&&console.error("PopupUtils.switchOrgRelatedLocalData()",err)}),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameOrgs,_storedParamsOrgs,function(err){if(err)return callback&&callback(err);var qLinks=PopupUtils.mergeAndSortQuickLinks(JSON.parse(server.ql||"[]"),$C.QuickLinks);chrome.tabs.query({},function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"CNT-SET-ORG-PARAMS",title:server.l,color:server.c,oid:server.oid,quickLinks:qLinks,from:"POPUP"})}),modal.modal("hide"),PopupUtils.syncData({noQuotaCheck:!0},function(err){return callback&&callback(err)})})}),modal.modal({keyboard:!1,backdrop:"static"}).modal("show").on("shown.bs.modal",function(){modal.find("#serverLabel").focus()}),modal},loadFromSyncStorage=function(callback){return PopupUtils.getConfigParameterLocal([PopupUtils.StorageParamNameOldSyncMethod,PopupUtils.StorageParamNameWorkerSyncStatus],function(err,params){return params=params||{},params[PopupUtils.StorageParamNameWorkerSyncStatus]=params[PopupUtils.StorageParamNameWorkerSyncStatus]||{},params[PopupUtils.StorageParamNameOldSyncMethod]||params[PopupUtils.StorageParamNameWorkerSyncStatus].passwordRequest?(debug.log("loadFromSyncStorage..."),PopupUtils.syncFromSyncStorage(disableInterface,handlePasswordRequest,function(err,params){return err?handleError(err):PopupUtils.getLocalPassphrase(function(err,val){return err?(PopupUtils.logError(err),handleError(err)):(_storedPassPhrase=val,_shortcuts=params.shortcuts,_apiLevel=params.apiLevel,callback&&callback())})})):PopupUtils.getLocalPassphrase(function(err,val){return err?(PopupUtils.logError(err),handleError(err)):(_storedPassPhrase=val,callback&&callback())})})},handleError=function(msg,callback){return msg?($("#alertBox").find(".modal-body p").html(msg),$("#alertBox").modal("show").on("hidden.bs.modal",function(){return callback&&callback()}),void $("#alertBox").find("#alertCloseBtn").click(function(){$("#alertBox").modal("hide")})):callback&&callback()},handleConfirm=function(msg,callback){$("#dialogBox").find(".modal-body p").html("").append($("<span>"+msg+"</span>")),$("#dialogBox").modal({keyboard:!1,backdrop:"static"}).modal("show").on("shown.bs.modal",function(){$("#dialogBox").find(".ui-no").focus()}),callback&&($("#dialogBox").find(".ui-yes").unbind("click").click(function(){callback(!0)}),$("#dialogBox").find(".ui-no").unbind("click").click(function(){callback(!1)}))},handleMessage=function(msg,callback){$("#messageBox").find(".modal-body p").html("").append($("<span>"+msg+"</span>")),$("#messageBox").modal({keyboard:!1,backdrop:"static"}).modal("show").on("shown.bs.modal",function(){$("#messageBox").find("#messageCloseBtn").focus()}),$("#messageBox").find("#messageCloseBtn").unbind("click").click(function(){return $("#messageBox").modal("hide"),callback&&callback()})},handlePasswordRequest=function(msg,callback){$("#passwordBox").find(".modal-body p").html("").append($("<span>"+msg+"</span>")),$("#passwordBox #encPassword").val("").keypress(function(e){if(13==e.which)return $("#passwordBox").find(".ui-ok").trigger("click")}),$("#passwordBox").on("shown.bs.modal",function(){$("#passwordBox #encPassword").focus()}).modal({keyboard:!1,backdrop:"static"}).modal("show"),callback&&($("#passwordBox").find(".ui-ok").unbind("click").click(function(){callback(!0,$("#passwordBox #encPassword").val())}),$("#passwordBox").find(".ui-cancel").unbind("click").click(function(){callback(!1)}))},createCollapsibleItem=function(domId,parentId,collapsed,title,content){collapsed=collapsed||!1,title=$("<span/>").text(title||"").text();var collapsible=$(' <div class="ui-account-group-container" data-group-name="'+title+'"> <div class="well well-sm ui-collapsible-header" role="tab" id="'+domId+'_head"><span class="glyphicon glyphicon-triangle-bottom ui-collapsible-caret"></span> <a role="button" class="black ui-collasped-title" data-toggle="collapse" data-parent="#x'+parentId+'" href="#'+domId+'_body" tabindex="-1" aria-expanded="'+(collapsed?"false":"true")+'" aria-controls="'+domId+'_body"></a></div><div id="'+domId+'_body" class="collapse '+(collapsed?"":"in")+'" role="tabpanel" aria-labelledby="'+domId+'_head"><div class="ui-collapsible-body"></div></div></div>');PopupUtils.resetStoredGroupStatus(collapsible),collapsible.find("a").attr("data-group-name",title);var htmlTitle=title;return content&&(htmlTitle='<span class="label label-primary"><small>'+content.find("li").length+"</small></span>&nbsp;"+resetFormatting(title)),collapsible.find("a").append($("<span>"+htmlTitle+"</span>")).attr("data-group-name",title),collapsible.find("#"+domId+"_body").on("hide.bs.collapse",function(){PopupUtils.storeGroupCollaspedStatus(title,!0),collapsible.find("span.ui-collapsible-caret").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-right")}).on("show.bs.collapse",function(){PopupUtils.storeGroupCollaspedStatus(title,!1),collapsible.find("span.ui-collapsible-caret").removeClass("glyphicon-triangle-right").addClass("glyphicon-triangle-bottom")}),content&&collapsible.find(".ui-collapsible-body").append($(content)),collapsible},validateAndSaveNewAccountForm=function(itemp,isNewItem,originalItem){var groupName=form.find("#groupName").val();groupName||(groupName=form.find("#newGroup").val());var url=form.find("#url").val();url||(url=form.find("#customUrl").val());var landingPage=form.find("#landingPage").val();landingPage||(landingPage=form.find("#customLandingPage").val());var currentItemPassword=(itemp||{}).p||"";if(currentItemPassword)if(_storedPassPhrase)currentItemPassword=PopupUtils.decryptText(currentItemPassword,_storedPassPhrase);else{var tmp=currentItemPassword;currentItemPassword=PopupUtils.deobfuscate(currentItemPassword),currentItemPassword||(currentItemPassword=tmp)}var newAccount={g:groupName,u:form.find("#username").val(),n:form.find("#name").val(),p:form.find("#password").is(":visible")?form.find("#password").val():currentItemPassword,t:form.find("#token").val(),r:url,s:form.find("#sync").is(":checked"),lt:form.find("#tokenLogin").is(":checked"),lo:form.find("#oauthLogin").is(":checked"),lp:landingPage,d:(new Date).getTime(),f:itemp&&itemp.f||!1};if(!newAccount.g)return handleError(chrome.i18n.getMessage("popup_newaccount_select_group"));if(!newAccount.u)return handleError(chrome.i18n.getMessage("popup_newaccount_set_username"));if(!newAccount.p&&!newAccount.lo)return handleError(chrome.i18n.getMessage("popup_newaccount_set_password"));if(!newAccount.r)return handleError(chrome.i18n.getMessage("popup_newaccount_select_loginurl"));_storedPassPhrase?newAccount.p=PopupUtils.encryptText(newAccount.p,_storedPassPhrase):newAccount.p=PopupUtils.obfuscate(newAccount.p);var isChangedSyncStatus=newAccount.s;itemp&&!isNewItem?(originalItem&&(isChangedSyncStatus=!originalItem.s&&newAccount.s),itemp.g=newAccount.g,itemp.u=newAccount.u,itemp.p=newAccount.p,itemp.t=newAccount.t,itemp.r=newAccount.r,itemp.n=newAccount.n,itemp.s=newAccount.s,itemp.lp=newAccount.lp,itemp.lt=newAccount.lt,itemp.lo=newAccount.lo,itemp.d=newAccount.d,itemp.f=newAccount.f):_storedParamsAccounts.push(newAccount),PopupUtils.checkLocalQuota(_storedParamsAccounts,function(err){return err&&isNewItem?handleError(err):void PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccounts,_storedParamsAccounts,function(err){return err?(PopupUtils.logError(err),handleError(chrome.i18n.getMessage("popup_general_unpexpected_error")+err)):(resetNewAccountForm(),$("#accountsTab").addClass("active"),$("#newAccountTab").removeClass("active"),$("#accountsTabHeader").trigger("click"),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab=null,_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus),void PopupUtils.syncData({noQuotaCheck:itemp&&!isNewItem&&!isChangedSyncStatus},function(err){err?(PopupUtils.logError(err),newAccount.s?(newAccount.s=!1,PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccounts,_storedParamsAccounts,function(err2){err2?(PopupUtils.logError(err2),handleError(chrome.i18n.getMessage("popup_general_unpexpected_error")+err2,function(){window.location.reload()})):handleError(err,function(){window.location.reload()})})):handleError(err,function(){window.location.reload()})):window.location.reload()}))})})},deleteAccount=function(itemp){if(itemp){var index=_storedParamsAccounts.indexOf(itemp);index>=0&&_storedParamsAccounts.splice(index,1),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccounts,_storedParamsAccounts,function(err){return err?(PopupUtils.logError(err),handleError(err)):(resetNewAccountForm(),$("#accountsTab").addClass("active"),$("#newAccountTab").removeClass("active"),void PopupUtils.syncData({noQuotaCheck:!0},function(err){err&&(PopupUtils.logError(err),handleError(err)),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab=null,_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus),window.location.reload()}))})}},configureSyncAccountButtons=function(){$("#syncYesBtn").unbind("click").on("click",function(){form.find("#sync").prop("checked",!0),$("#syncYesBtn").removeClass("btn-default").addClass("active").addClass("btn-success"),$("#syncNoBtn").removeClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.s=!0,PopupUtils.setPopupStatus(_popupInitStatus))}),$("#syncNoBtn").unbind("click").on("click",function(){form.find("#sync").prop("checked",!1),$("#syncYesBtn").removeClass("btn-success").removeClass("active").addClass("btn-default"),$("#syncNoBtn").addClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.s=!1,PopupUtils.setPopupStatus(_popupInitStatus))}),form.find("#sync").is(":checked")?$("#syncYesBtn").trigger("click"):$("#syncNoBtn").trigger("click")},configureLoginWithTokenAccountButtons=function(){$("#tokenLoginYesBtn").unbind("click").on("click",function(){form.find("#tokenLogin").prop("checked",!0),$("#tokenLoginYesBtn").removeClass("btn-default").addClass("active").addClass("btn-info"),$("#tokenLoginNoBtn").removeClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.lt=!0,PopupUtils.setPopupStatus(_popupInitStatus))}),$("#tokenLoginNoBtn").unbind("click").on("click",function(){form.find("#tokenLogin").prop("checked",!1),$("#tokenLoginYesBtn").removeClass("btn-info").removeClass("active").addClass("btn-default"),$("#tokenLoginNoBtn").addClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.lt=!1,PopupUtils.setPopupStatus(_popupInitStatus))}),form.find("#tokenLogin").is(":checked")?$("#tokenLoginYesBtn").trigger("click"):$("#tokenLoginNoBtn").trigger("click")},configureLoginWithOauthAccountButtons=function(){$("#oauthLoginYesBtn").unbind("click").on("click",function(){form.find("#oauthLogin").prop("checked",!0),$("#oauthLoginYesBtn").removeClass("btn-default").addClass("active").addClass("btn-info"),$("#oauthLoginNoBtn").removeClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.lo=!0,PopupUtils.setPopupStatus(_popupInitStatus))}),$("#oauthLoginNoBtn").unbind("click").on("click",function(){form.find("#oauthLogin").prop("checked",!1),$("#oauthLoginYesBtn").removeClass("btn-info").removeClass("active").addClass("btn-default"),$("#oauthLoginNoBtn").addClass("active"),_popupInitStatus&&_popupInitStatus.item&&(_popupInitStatus.item.lo=!1,PopupUtils.setPopupStatus(_popupInitStatus))}),form.find("#oauthLogin").is(":checked")?$("#oauthLoginYesBtn").trigger("click"):$("#oauthLoginNoBtn").trigger("click")},handleAccountListItem=function(index,item,accountsListTable){var account=$('<li class="list-group-item ui-account-item-li" data-index="'+index+'" title="Drag to sort..."><div class="row"><div class="col-xs-4"> <div class="btn-group btn-group-justified ui-action-buttons" role="group"><span class="btn btn-xs action-favorite" title="Favorite login" ><span class="fa fa-star-o text-warning" /></span> <a class="btn btn-xs btn-success action-tab" title="'+chrome.i18n.getMessage("popup_activeorg_open_tab")+'" href="#"><span class="fa fa-folder-open-o" /></a> <a class="btn btn-xs btn-default action-devconsole" title="'+chrome.i18n.getMessage("popup_activeorg_open_developerconsole")+'" href="#"><span class="fa fa-keyboard-o" /></a> <a class="btn btn-xs btn-warning action-window" title="'+chrome.i18n.getMessage("popup_activeorg_open_window")+'" href="#"><span class="fa fa-file-o" /></a> <a class="btn btn-xs btn-danger action-incognito" title="'+chrome.i18n.getMessage("popup_activeorg_open_incognito")+'" href="#"><span class="fa fa-user-secret" /></a> <a class="btn btn-xs action-password" title="'+chrome.i18n.getMessage("popup_activeorg_copy_passwordtoken")+'" href="#"><span class="fa fa-key" /></a> </div></div><div class=" col-xs-6"><div class="ui-account-name-container"><small><strong class="ui-account-name">'+$("<span/>").text(item.n||"").html()+(item.s?'&nbsp;<i class="fa fa-refresh text-muted" title="Synced"></i>':"")+'</strong></small></div><div class="ui-account-username-container"><span class="text-primary ui-account-username" title="'+chrome.i18n.getMessage("popup_activeorg_click_username_to_edit")+'"><strong class="ui-account-username"><small>'+$("<span/>").text(item.u).html()+'</small></strong></span> </div></div><div class=" col-xs-2"><span class="accs-setting-icon mouse-pointer" title="Edit login"><i class="fa fa-edit" aria-hidden="true"></i></span><span class="accs-delete-icon mouse-pointer" title="Delete login""><i class="fa fa-trash-o" aria-hidden="true"></i></span></div></div></li>');item.f&&account.find(".action-favorite").find("span").removeClass("fa-star-o").addClass("fa-star"),accountsListTable.append(account),account.find(".action-favorite").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_FAVORITE.name,$C.Analytics.EVENTS.POPUP_ACTION.name),item.f=!item.f,item.f?account.find(".action-favorite").find("span").removeClass("fa-star-o").addClass("fa-star"):account.find(".action-favorite").find("span").removeClass("fa-star").addClass("fa-star-o"),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccounts,_storedParamsAccounts,function(err){return err?(PopupUtils.logError(err),handleError(new Error("ORGanizer unexpected error [2]: "+err))):void PopupUtils.syncData({noQuotaCheck:!0},function(err){return err?(PopupUtils.logError(err),handleError(new Error("ORGanizer unexpected error [3]: "+err))):void init()})})});var loginCallback=function(err){if(handleLoadingMessage(),err)return handleError(err)},loadingFn=function(){handleLoadingMessage("Loading...")};account.find(".action-tab").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_TAB.name,$C.Analytics.EVENTS.POPUP_ACTION.name,function(){})}).click(PopupUtils.createFormLoginAction("_blank",item.r,item.u,item.p,item.t,item.lp,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)),account.find(".action-devconsole").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_DEVCONSOLE.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(PopupUtils.createFormLoginAction("_blank",item.r,item.u,item.p,item.t,PopupUtils.DevConsolePage,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)),account.find(".action-window").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_WINDOW.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(PopupUtils.createFormLoginAction("_new",item.r,item.u,item.p,item.t,item.lp,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)),account.find(".action-incognito").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_INCOGNITO.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(PopupUtils.createFormLoginAction("_incognito",item.r,item.u,item.p,item.t,item.lp,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)),account.find(".action-password").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ACTION_PASSWORD.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(function(){var isCopy=$(this).hasClass("action-copy");return!_storedPassPhrase||PopupUtils.pinEnabled(_pinConfiguration)&&!PopupUtils.pinExpired(_pinConfiguration)?void PopupUtils.createFormLoginAction(isCopy?"_copy":"_password",item.r,item.u,item.p,item.t,item.lp,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)():void handlePasswordRequest(chrome.i18n.getMessage("opts_pwd_message_type_current_pwd"),function(success,password){if(success){if(password=(password||"").trim(),!password)return handleError(new Error(chrome.i18n.getMessage("opts_pwd_set_valid_pwd")));if(_storedPassPhrase!==password)return handleError(new Error(chrome.i18n.getMessage("opts_pwd_message_invalid_password")));PopupUtils.pinEnabled(_pinConfiguration)&&PopupUtils.pinExpired(_pinConfiguration)&&PopupUtils.updatePinLastCheck(_pinConfiguration),PopupUtils.createFormLoginAction(isCopy?"_copy":"_password",item.r,item.u,item.p,item.t,item.lp,item.lt,item.lo,_storedPassPhrase,!1,loginCallback,loadingFn)()}})}),account.find("span.accs-delete-icon").click(function(){handleConfirm(chrome.i18n.getMessage("popup_account_delete_confirm_message"),function(result){result&&deleteAccount(item)})}),account.find("span.accs-setting-icon").click(function(){$("#accountsTab").removeClass("active"),$("#newAccountTab").addClass("active"),form.find("#newBtn").hide(),form.find("#updateBtn").show(),form.find("#cancelBtn").show(),form.find("#deleteBtn").show(),form.find("#saveasBtn").show();var originalItem=JSON.parse(JSON.stringify(item));populateCachedAccountDataFromItem(item),form.find("#updateBtn").unbind("click").click(function(){return validateAndSaveNewAccountForm(item,!1,originalItem)}),form.find("#saveasBtn").unbind("click").click(function(){for(var key in originalItem)item[key]=originalItem[key];var newItem=JSON.parse(JSON.stringify(item));return newItem.d=(new Date).getTime(),validateAndSaveNewAccountForm(newItem,!0,null)}),form.find("#deleteBtn").unbind("click").click(function(){handleConfirm(chrome.i18n.getMessage("popup_account_delete_confirm_message"),function(result){result&&deleteAccount(item)})}),form.find("#cancelBtn").unbind("click").click(function(){resetNewAccountForm(),$("#accountsTab").addClass("active"),$("#newAccountTab").removeClass("active"),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab=null,_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus),init()}),form.find("#revokeOAuthlnk").unbind("click").click(function(){PopupUtils.getOAuthTokenData(item.u,item.r,null,!1,function(err,token){return err?handleMessage("Nothing to revoke. No token is stored."):void PopupUtils.revokeOAuthToken(token.access_token,item.r,function(err,rsp){err&&debug.log(err),PopupUtils.revokeOAuthToken(token.refresh_token,item.r,function(err,rsp){return err&&debug.log(err),handleMessage("Access token succesfully revoked!")})})})}),configureSyncAccountButtons(),configureLoginWithTokenAccountButtons(),configureLoginWithOauthAccountButtons(),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab="EDIT",_popupInitStatus.item=item,_popupInitStatus.itemIndex=index,PopupUtils.setPopupStatus(_popupInitStatus)}),account.find("div.ui-account-username-container").click(function(){PopupUtils.copyToClipboard(item.u)})},resetNewAccountForm=function(){form.find("#groupName").val(""),form.find("#newGroup").val(""),form.find("#username").val(""),form.find("#name").val(""),form.find("#password").val("").show(),form.find("#passwordMasked").val("").hide(),form.find("#sync").prop("checked",!1),
form.find("#tokenLogin").prop("checked",!1),form.find("#oauthLogin").prop("checked",!1),form.find("#token").val(""),form.find("#url").val(""),form.find("#customUrl").val(""),form.find("#url").val(form.find("#url option:first").val()),form.find("#landingPage").val(""),form.find("#customLandingPage").val(""),form.find("#landingPage").val(form.find("#landingPage option:first").val()),form.find("#groupName").val(form.find("#groupName option:first").val()),form.find("#customUrl").hide(),form.find("#customLandingPage").hide(),form.find("#newGroup").hide(),form.find("#newBtn").show(),form.find("#updateBtn").hide(),form.find("#cancelBtn").hide(),form.find("#deleteBtn").hide(),form.find("#saveAsBtn").hide(),configureSyncAccountButtons(),configureLoginWithTokenAccountButtons(),configureLoginWithOauthAccountButtons()},populateConfiguredOrgs=function(callback){function createServerLabelClickHandler(serverOID,serverNameDomain){return function(){createServerParamsBox(serverOID,serverNameDomain,!0,function(){populateConfiguredOrgs()})}}var parent=$("#confOrgsUl").html("");if(!_storedParamsOrgs.length)return void parent.append($('<div class="alert alert-info text-center"><strong>'+chrome.i18n.getMessage("popup_no_configured_org_found")+"</strong></div>"));$("#sortOrgByNameBtn").click(function(){return $(this).hide(),$("#sortOrgByUpdateBtn").show(),_sortOrgsByName=!0,populateConfiguredOrgs()}),$("#sortOrgByUpdateBtn").click(function(){return $(this).hide(),$("#sortOrgByNameBtn").show(),_sortOrgsByName=!1,populateConfiguredOrgs()});for(var customSortedOrgs=_storedParamsOrgs.sort(function(x,y){if(!_sortOrgsByName){if(!x.d)return 1;if(!y.d)return-1;if(x.d>y.d)return-1;if(x.d<y.d)return 1}return x.n<y.n?-1:x.n>y.n?1:x.l<y.l?-1:x.l>y.l?1:0}),i=0;i<customSortedOrgs.length;i++){var orgSettings=customSortedOrgs[i],li=$('<li class="list-group-item" />'),serverLabel=(orgSettings.n||"").toUpperCase();orgSettings&&orgSettings.l&&(serverLabel='<span class="ui-server-name">['+(orgSettings.n||"").toUpperCase()+"]</span> "+resetFormatting(orgSettings.l||"")),li.append($('<h4 class="list-group-item-heading" ><small class="ui-server-label" title="ORG ID: '+orgSettings.oid+'" data-oid="'+orgSettings.oid+'"><strong>'+serverLabel+'</strong></small> <span class="glyphicon glyphicon-cloud ui-cloud-server-icon" style="color: #'+(orgSettings.c||"").replace("#","")+'" /> '+(orgSettings.d?'<small class="ui-org-last-updated">Last updated: '+new Date(orgSettings.d).toLocaleString()+"</small>":"")+"</h4>"));var settingBtn=$('<span class="ogzr-setting-icon mouse-pointer"><i class="fa fa-edit" aria-hidden="true"></i></span>');settingBtn.click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ORGANIZER_SETTING_ICON.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(createServerLabelClickHandler(orgSettings.oid,(orgSettings.n||"").toUpperCase()));var groupContainer=$('<span class="ogzr-delete-icon mouse-pointer" />'),deleteBtn=$('<i class="fa fa-trash-o" aria-hidden="true"></i>').attr("data-oid",orgSettings.oid).on("click",function(){var oid=$(this).attr("data-oid");handleConfirm(chrome.i18n.getMessage("popup_org_delete_confirm_message"),function(result){if(result){for(var oi=0;oi<_storedParamsOrgs.length;oi++)_storedParamsOrgs[oi].oid===oid&&_storedParamsOrgs.splice(oi,1);PopupUtils.deleteOrgHistory(oid,function(){PopupUtils.deletePluginStorage(oid,function(){PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameOrgs,_storedParamsOrgs,function(err){return err?(PopupUtils.logError(err),handleError("Unexpected error: "+err)):(chrome.tabs.query({},function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"CNT-SET-ORG-PARAMS",title:"",color:null,oid:oid,from:"POPUP"})}),populateConfiguredOrgs(),void PopupUtils.syncData({noQuotaCheck:!0},function(err){if(err)return PopupUtils.logError(err),handleError(err)}))})})})}})});groupContainer.append(deleteBtn),li.find("h4").append(groupContainer).append(settingBtn),parent.append(li)}},populateActiveOrgs=function(callback){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){PopupUtils.getCookieStoreFromTabId(tabs[0].id,function(storeId){PopupUtils.getActiveSessions(tabs[0].id,storeId,function(err,sessions){function createServerLabelClickHandler(serverOID,serverNameDomain){return function(){createServerParamsBox(serverOID,serverNameDomain,!1,function(){init()})}}if(err)return PopupUtils.logError(err),handleError(err);var parent=$("#activeSessionsUl").html(""),serverNames=[];for(var key in sessions)serverNames.push(key);if(serverNames.sort(),!serverNames.length)return parent.append($('<div class="alert alert-info text-center"><strong>'+chrome.i18n.getMessage("popup_no_active_org_found")+"</strong></div>")),callback&&callback();_activeOrgsList=[];for(var i=0;i<serverNames.length;i++){var session=sessions[serverNames[i]];if(session){for(var li=$('<li class="list-group-item" />'),orgSettings=null,si=0;si<_storedParamsOrgs.length;si++){var isMyDomain=PopupUtils.isMyDomain(session.server||"");if(isMyDomain&&(session.server||"").toUpperCase()===_storedParamsOrgs[si].n||session.oid===_storedParamsOrgs[si].oid){orgSettings=_storedParamsOrgs[si];break}}var serverLabel=session.server.toUpperCase();serverLabel='<span class="ui-server-name">['+serverLabel+"]</span> "+resetFormatting(orgSettings&&orgSettings.l||""),li.append($('<h4 class="list-group-item-heading" ><small class="ui-server-label" title="ORG ID: '+session.oid+'" data-oid="'+session.oid+'">'+serverLabel+"</small> "+(orgSettings&&orgSettings.c?' <span class="glyphicon glyphicon-cloud ui-cloud-server-icon" style="color:#'+(orgSettings.c||"").replace("#","")+'" />':"")+(orgSettings&&orgSettings.d?'<small class="ui-org-last-updated">Last updated: '+new Date(orgSettings.d).toLocaleString()+"</small>":"")+'<span class="ogzr-setting-icon mouse-pointer"><i class="fa fa-edit" aria-hidden="true"></i></span></h4>')),_activeOrgsList.push(session.oid),li.find(".ogzr-setting-icon").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.ORGANIZER_SETTING_ICON.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(createServerLabelClickHandler(session.oid,session.server.toUpperCase()));var btnContainer=$('<div class="list-group-item-text" />'),groupContainer=$('<div class="btn-group btn-group-justified" />');btnContainer.append(groupContainer);var homeBtn=$('<a class="btn btn-xs btn-success mouse-pointer">Home</a>').attr("data-href",session.linkHome).on("click",function(){chrome.tabs.create({url:$(this).attr("data-href")})}),setupBtn=$('<a class="btn btn-xs btn-primary mouse-pointer">Setup</a>').attr("data-href",session.linkSetup).on("click",function(){chrome.tabs.create({url:$(this).attr("data-href")})}),devConsoleBtn=$('<a class="btn btn-xs btn-warning mouse-pointer">Dev Console</a>').attr("data-href",session.linkDevConsole).on("click",function(){chrome.tabs.create({url:$(this).attr("data-href")})});groupContainer.append(homeBtn).append(setupBtn).append(devConsoleBtn),li.append(btnContainer),parent.append(li)}}return callback&&callback()})})})},loadLocalMainData=function(callback){$LicUtils.checkActionsCounterHit(function(err,actionsLimitHit){return PopupUtils.loadLocalMainData(function(err,localParams){if(err)return callback&&callback(err);if(_storedPassPhrase=localParams.storedPassPhrase,_storedParamsAccounts=localParams.storedParamsAccounts,_storedParamsOrgs=localParams.storedParamsOrgs,_shortcuts=localParams.shortcuts,_popupInitStatus=localParams.popupInitStatus,_showAlertChangeLog=localParams.showAlertChangeLog,_storedOrderedGroups=localParams.storedOrderedGroups,_storedSortedAccountsPerGroup=localParams.storedOrderedAccountsOnGroups,_pinConfiguration=localParams.pinConfiguration,_filterFavoriteLogins=localParams.filterFavoriteLogins,_actionsCounterLimitHit=actionsLimitHit,actionsLimitHit){var freezePanel=$("#_actionsLimitContent"),overlayCallback=function(){$LicUtils.getOverlayAction()},message=$LicUtils.createOverlayContent(overlayCallback);return freezePanel.append(message),freezePanel.parent().show(),callback&&callback()}return callback&&callback()})})},init=function(){var manifestVersion=(chrome.runtime.getManifest().version||"").replace("10000.","");$("#versionSpan").text(manifestVersion),$("#quickSearchAccountsListInput").val(""),accountListAccordion.html(""),loadLocalMainData(function(err){if(err)return PopupUtils.logError(err),handleError(err);for(var customSortedAccounts=_storedParamsAccounts.sort(function(x,y){return x.n<y.n?-1:x.n>y.n?1:x.u<y.u?-1:x.u>y.u?1:0}),groups={},defaultHasAccounts=!1,i=0;i<customSortedAccounts.length;i++){var item=customSortedAccounts[i];if(item){var groupName=item.g||_defaultGroupName,group=groups[groupName];group||(group=[],groups[groupName]=group),group.push(item),groupName===_defaultGroupName&&(defaultHasAccounts=!0)}}groups[_defaultGroupName]||(groups[_defaultGroupName]=[]),form.find("#groupName").html(""),form.find("#groupName").append($("<option/>").val(_defaultGroupName).text(_defaultGroupName));var counter=0,keys=[];for(var key in groups)groups.hasOwnProperty(key)&&key!==_defaultGroupName&&keys.push(key);if(keys.sort(),keys.unshift(_defaultGroupName),_storedOrderedGroups&&_storedOrderedGroups.length){for(var g=_storedOrderedGroups.length-1;g>=0;g--)keys.indexOf(_storedOrderedGroups[g])<0&&_storedOrderedGroups.splice(g,1);for(var g=0;g<keys.length;g++)_storedOrderedGroups.indexOf(keys[g])<0&&_storedOrderedGroups.push(keys[g])}else _storedOrderedGroups=keys;for(var k=0;k<_storedOrderedGroups.length;k++){var key=_storedOrderedGroups[k];if(counter++,key!==_defaultGroupName&&form.find("#groupName").append($("<option/>").val(key).text(key)),defaultHasAccounts||key!==_defaultGroupName){var items=groups[key],accountsListTable=$('<ul class="list-group" />'),groupHasFavorite=!1;debug.log("##### _storedSortedAccountsPerGroup, ",_storedSortedAccountsPerGroup);var sortedItems=[];if(_storedSortedAccountsPerGroup&&_storedSortedAccountsPerGroup[key]&&_storedSortedAccountsPerGroup[key].length){for(var li=0;li<_storedSortedAccountsPerGroup[key].length;li++)for(var loginKey=_storedSortedAccountsPerGroup[key][li],ii=items.length-1;ii>=0;ii--)if(items[ii].u===loginKey){sortedItems.push(items.splice(ii,1)[0]);break}for(var ii=items.length-1;ii>=0;ii--)sortedItems.push(items.splice(ii,1)[0])}else sortedItems=items;groups[key]=sortedItems;for(var i=0;i<sortedItems.length;i++)_filterFavoriteLogins&&!sortedItems[i].f||(groupHasFavorite=!0,handleAccountListItem(k+""+i,sortedItems[i],accountsListTable));if(groupHasFavorite){var acc1=createCollapsibleItem("group_"+counter,accountListAccordion.attr("id"),!1,key,accountsListTable);accountListAccordion.append(acc1)}}}PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccountGroupSorted,_storedOrderedGroups,function(err){}),accountListAccordion.sortable({handle:".ui-collapsible-header",stop:function(event,ui){_storedOrderedGroups=[],accountListAccordion.find(".ui-account-group-container").each(function(){_storedOrderedGroups.push($(this).attr("data-group-name"))}),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccountGroupSorted,_storedOrderedGroups,function(err){return err?(PopupUtils.logError(err),handleError("Unexpected error: "+err)):void PopupUtils.syncData({noQuotaCheck:!0},function(err){if(err)return PopupUtils.logError(err),handleError(err)})})}}),accountListAccordion.find(".ui-account-group-container ul.list-group").sortable({stop:function(event,ui){var parent=$(this).closest(".ui-account-group-container"),groupName=parent.attr("data-group-name");_storedSortedAccountsPerGroup||(_storedSortedAccountsPerGroup={});var group=[];$(this).find("li.ui-account-item-li").each(function(){group.push($(this).find("strong.ui-account-username").text())}),_storedSortedAccountsPerGroup[groupName]=group,debug.log("_storedSortedAccountsPerGroup",_storedSortedAccountsPerGroup),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameAccountsOnGroupSorted,_storedSortedAccountsPerGroup,function(err){return err?(PopupUtils.logError(err),handleError("Unexpected error: "+err)):void PopupUtils.syncData({noQuotaCheck:!0},function(err){if(err)return PopupUtils.logError(err),handleError(err)})})}}),form.find("#groupName").prepend($("<option/>").val("").text(_otherValue)),form.find("#groupName").unbind("change").on("change",function(){$(this).val()?form.find("#newGroup").hide():form.find("#newGroup").show()}),form.find("#groupName").unbind("click").on("click",function(){_popupInitStatus.item.g=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#newGroup").unbind("keyup").on("keyup",function(){_popupInitStatus.item.g=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#username").unbind("keyup").on("keyup",function(){_popupInitStatus.item.u=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#password").unbind("keyup").on("keyup",function(){_popupInitStatus.item.p=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#name").unbind("keyup").on("keyup",function(){_popupInitStatus.item.n=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#token").unbind("keyup").on("keyup",function(){_popupInitStatus.item.t=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#url").unbind("click").on("click",function(){_popupInitStatus.item.r=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#customUrl").unbind("keyup").on("keyup",function(){_popupInitStatus.item.r=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#landingPage").unbind("click").on("click",function(){_popupInitStatus.item.lp=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find("#customLandingPage").unbind("keyup").on("keyup",function(){_popupInitStatus.item.lp=$(this).val(),PopupUtils.setPopupStatus(_popupInitStatus)}),form.find(".ui-show-password").unbind("click").on("click",function(){var inputPwd=form.find("#password");if("text"===inputPwd.attr("type"))inputPwd.attr("type","password");else{if(!_storedPassPhrase||PopupUtils.pinEnabled(_pinConfiguration)&&!PopupUtils.pinExpired(_pinConfiguration)){if(inputPwd.val()&&_storedPassPhrase&&form.find("#passwordMasked").is(":visible")){var tmp=PopupUtils.decryptText(inputPwd.val(),_storedPassPhrase);inputPwd.val(tmp)}return form.find("#passwordMasked").hide(),inputPwd.attr("type","text").show()}handlePasswordRequest(chrome.i18n.getMessage("opts_pwd_message_type_current_pwd"),function(success,password){if(success){if(password=(password||"").trim(),!password)return handleError(new Error(chrome.i18n.getMessage("opts_pwd_set_valid_pwd")));if(_storedPassPhrase!==password)return handleError(new Error(chrome.i18n.getMessage("opts_pwd_message_invalid_password")));PopupUtils.pinEnabled(_pinConfiguration)&&PopupUtils.pinExpired(_pinConfiguration)&&PopupUtils.updatePinLastCheck(_pinConfiguration),_storedPassPhrase&&inputPwd.val()&&!inputPwd.is(":visible")&&inputPwd.val(PopupUtils.decryptText(inputPwd.val(),_storedPassPhrase)),form.find("#passwordMasked").hide(),inputPwd.attr("type","text").show()}})}}),populateActiveOrgs(function(){if(_popupInitStatus.tab){if("ORGS"===_popupInitStatus.tab)$("#openOrgsTabHeader").tab("show"),"ALL"===_popupInitStatus.subtab&&$("#orgsConfListBtn").trigger("click");else if("ACCOUNTS"===_popupInitStatus.tab){var status=JSON.parse(JSON.stringify(_popupInitStatus));$("#accountsTabHeader").tab("show"),"NEW"===_popupInitStatus.subtab?$("#newAccountBtn").trigger("click"):"EDIT"===_popupInitStatus.subtab&&Number.isInteger(parseInt(_popupInitStatus.itemIndex))&&_popupInitStatus.item&&$('li.ui-account-item-li[data-index="'+_popupInitStatus.itemIndex+'"]').find("span.accs-setting-icon").trigger("click"),_popupInitStatus=status,_popupInitStatus.item&&(populateCachedAccountDataFromItem(_popupInitStatus.item),configureSyncAccountButtons(),configureLoginWithTokenAccountButtons(),configureLoginWithOauthAccountButtons())}}else _activeOrgsList.length?($("#openOrgsTabHeader").tab("show"),_popupInitStatus.tab="ORGS"):($("#accountsTabHeader").tab("show"),_popupInitStatus.tab="ACCOUNTS");PopupUtils.setPopupStatus(_popupInitStatus)}),debug.log("_filterFavoriteLogins",_filterFavoriteLogins),_filterFavoriteLogins&&$("#filterFavoriteBtn").addClass("btn-warning").find("span").removeClass("fa-star-o").addClass("fa-star"),_showAlertChangeLog&&$("#changeLogIcon").show()}),$("#changeLogAdvisor").unbind("click").click(function(){$("#changeLogIcon").hide(),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameLastVersionInstalled,!1),chrome.tabs.create({url:$C.Endpoints.ChangeLog})}),$(".ui-logo").unbind("click").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_SPONSOR.Actions.DONATE_LINK.name,$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:$C.Endpoints.Donate})})}),$("#subscribeLink").unbind("click").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_SPONSOR.Actions.SUBSCRIBE_LINK.name,$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:$C.Endpoints.Subscribe})})}),_sponsorsRetrieved||(_sponsorsRetrieved=!0,chrome.runtime.sendMessage({action:"BKG-GET-PURCHASED-PRODUCTS"},function(rslt){var purchasedProducts=rslt.purchasedProducts;if(purchasedProducts)for(var pi=0;pi<purchasedProducts.length;pi++)if("EXPIRED"===purchasedProducts[pi].state){handleError("Some promo codes are expired. Go to the Options page to remove them or apply a new promo code.");break}PopupUtils.getSponsors({location:"popup",products:purchasedProducts},function(err,results){err&&(debug.log("Sponsors",err,results),results=[]);for(var bannersPlaced={},i=0;i<results.length;i++){var el,banner=results[i],bannerId="banner-"+banner.index,bannerFolder=$C.Endpoints.BannersFolder;0===bannerFolder.indexOf("@@")&&(bannerFolder=$C.Endpoints.BannersFolder_DEV),"banner"===banner.type?el=$("<img/>").addClass("ui-popup-banner-image").attr("title",banner.description||banner.tagline).attr("alt",banner.description||banner.tagline).attr("src",bannerFolder+banner.bannerUrl):"text"===banner.type&&(el=$("<div/>").addClass("ui-popup-banner-text").attr("title",banner.description||"").append("<span>"+banner.tagline+"</span>")),el&&(el.attr("data-href",banner.companyUrl).attr("data-banner-id",banner.id).click(function(){var url=$(this).attr("data-href");PopupUtils.sendAnalyticsEventToBackground($(this).attr("data-banner-id"),$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:url})})}),$("#"+bannerId).empty().append(el),bannersPlaced[bannerId]=banner.id)}PopupUtils.getLicenseLimits(null,function(err,limits){limits.license!==PopupUtils.LicenseTypes[PopupUtils.LicenseTypeIndex.Full]?($(".ui-banner-tab-top-container").show(),$(".ui-banner-tab-bottom-container").show(),$(".tab-content.no-sponsor").removeClass("no-sponsor"),$(".donate-link").show(),$("#proLabel").hide()):($("#proLabel").show(),$(".donate-link").hide()),limits.license===PopupUtils.LicenseTypes[PopupUtils.LicenseTypeIndex.Lite]&&$("#proLiteLabel").show()})})})),$("#sponsorship-link").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_SPONSOR.Actions.SPONSORSHIP_TEXT.name,$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:$C.Endpoints.SponsorshipProgramLink})})}),$("#gopro-link").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_SPONSOR.Actions.GORPO_TEST.name,$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:chrome.runtime.getURL("options.html")+"?tab=%23proPanel"})})}),$("#sponsorship-link-bottom").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_SPONSOR.Actions.SPONSORSHIP_TEXT.name,$C.Analytics.EVENTS.POPUP_SPONSOR.name,function(){chrome.tabs.create({url:$C.Endpoints.SponsorshipProgramLink})})})};form.find("#url").on("change",function(){$(this).val()?form.find("#customUrl").hide():form.find("#customUrl").show()}),form.find("#landingPage").on("change",function(){$(this).val()?form.find("#customLandingPage").hide():form.find("#customLandingPage").show()}),form.find("#newBtn").unbind("click").click(function(){return validateAndSaveNewAccountForm(null,!0,null)}),$("#accountsTabHeader, #backToAccountsListBtn").click(function(ev){ev.preventDefault(),resetNewAccountForm(),$("#accountsTab").addClass("active"),$("#newAccountTab").removeClass("active"),$("#accountsTabHeader").tab("show"),$("#quickSearchAccountsListInput").focus(),$(".ui-quick-search-cancel").trigger("click"),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab=null,_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus)}),$("#openOrgsTabHeader").on("shown.bs.tab",function(){$("#quickSearchActiveOrgsInput").val(""),$("#quickSearchConfigOrgsInput").val(""),$("#quickSearchAccountsListInput").val(""),$("#quickSearchActiveOrgsInput").focus(),$(".ui-quick-search-cancel").trigger("click")}),$("#accountsTabHeader").on("shown.bs.tab",function(){$("#quickSearchActiveOrgsInput").val(""),$("#quickSearchConfigOrgsInput").val(""),$("#quickSearchAccountsListInput").val(""),$("#quickSearchAccountsListInput").focus(),$(".ui-quick-search-cancel").trigger("click")}),$("#messagesTabHeader").click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.MESSAGE_TAB_HEADER.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}).click(function(){$("#accountsTabHeader").parent().removeClass("active"),$("#openOrgsTabHeader").parent().removeClass("active")}),$("#messagesTabHeader").on("shown.bs.tab",function(){$("#messagesTabHeader").find(".ui-message-tab-logo").removeClass("fa-blink");var lastMsgDate=$("#messagesTabHeader").attr("data-last-message-date");PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameLastMessageSeen,lastMsgDate)}),$("#newAccountBtn").click(function(ev){ev.preventDefault(),resetNewAccountForm(),$("#saveasBtn").hide(),$("#exportTextarea").val(""),$("#accountsTab").removeClass("active"),$("#newAccountTab").addClass("active"),$("#exportTab").removeClass("active"),$("#newAccountTabHeader").tab("show"),$(".ui-quick-search-cancel").trigger("click"),$("#groupName").val($("#groupName option:nth-child(2)").val()),_popupInitStatus.tab="ACCOUNTS",_popupInitStatus.subtab="NEW",_popupInitStatus.item={g:$("#groupName").val()},PopupUtils.setPopupStatus(_popupInitStatus)}).click(function(){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.NEW_ACCOUNT_BTN.name,$C.Analytics.EVENTS.POPUP_ACTION.name)}),$("#filterFavoriteBtn").click(function(ev){PopupUtils.sendAnalyticsEventToBackground($C.Analytics.EVENTS.POPUP_ACTION.Actions.FILTER_FAVORITE_BTN.name,$C.Analytics.EVENTS.POPUP_ACTION.name),_filterFavoriteLogins=!_filterFavoriteLogins,_filterFavoriteLogins?($(this).addClass("btn-warning"),$(this).find("span").removeClass("fa-star-o").addClass("fa-star")):($(this).removeClass("btn-warning"),$(this).find("span").removeClass("fa-star").addClass("fa-star-o")),PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameFavoriteLogins,_filterFavoriteLogins,function(err){init()})}),$("#openOrgsTabHeader, #backToActiveOrgsBtn").click(function(ev){ev.preventDefault(),$("#quickSearchActiveOrgsInput").val(""),$("#quickSearchConfigOrgsInput").val(""),$("#quickSearchAccountsListInput").val(""),$("#openOrgsTab").addClass("active"),$("#configuredOrgsTab").removeClass("active"),populateActiveOrgs(),$("#openOrgsTabHeader").tab("show"),$("#quickSearchActiveOrgsInput").focus(),$(".ui-quick-search-cancel").trigger("click"),_popupInitStatus.tab="ORGS",_popupInitStatus.subtab="ACTIVE",_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus)}),$("#orgsConfListBtn").click(function(ev){ev.preventDefault(),$("#quickSearchActiveOrgsInput").val(""),$("#quickSearchConfigOrgsInput").val(""),$("#quickSearchAccountsListInput").val(""),$("#openOrgsTab").removeClass("active"),$("#configuredOrgsTab").addClass("active"),populateConfiguredOrgs(),$("#quickSearchConfigOrgsInput").focus(),$(".ui-quick-search-cancel").trigger("click"),_popupInitStatus.tab="ORGS",_popupInitStatus.subtab="ALL",_popupInitStatus.item=null,PopupUtils.setPopupStatus(_popupInitStatus)}),$("#quickSearchAccountsListInput").on("keyup",function(evt){filterAccountList("quickSearchAccountsListInput","accountListAccordion"),13==evt.keyCode&&$("div.ui-action-buttons:visible").first().find(".action-tab").click()}),$("#quickSearchActiveOrgsInput").on("keyup",function(){filterOrgsList("quickSearchActiveOrgsInput","activeSessionsUl")}),$("#quickSearchConfigOrgsInput").on("keyup",function(){filterOrgsList("quickSearchConfigOrgsInput","confOrgsUl")}),$(".ui-quick-search-cancel").click(function(){$(this).parent().find("input").val("").trigger("keyup")}),$(".ui-quick-search-cancel").hide().parent().find("input").keyup(function(){$(this).val()?$(this).parent().find(".ui-quick-search-cancel").show():$(this).parent().find(".ui-quick-search-cancel").hide()}),$("#manualDownloadBtn").click(function(){var options={localPassPhrase:_storedPassPhrase,handleCompression:!0};PopupUtils.exportManualBackup(options,function(err){if(err)return handleError(err)})}),PopupUtils.checkVendorMessages(function(err,data){return err?void $("#messagesList").find(".list-group-item").append($("<span>"+chrome.i18n.getMessage("popup_messages_error")+"</span>")):data&&data.length?($("#messagesList").html(""),data.sort(function(a,b){return a.createdDate?b.createdDate?new Date(a.createdDate)>new Date(b.createdDate)?-1:new Date(a.createdDate)<new Date(b.createdDate)?1:(a.relevance||0)>(b.relevance||0)?1:-1:1:-1}),void PopupUtils.getConfigParameterLocal([PopupUtils.StorageParamNameLastMessageSeen],function(err,params){var lastMessageSeen=params[PopupUtils.StorageParamNameLastMessageSeen];$("#messagesTabHeader").attr("data-last-message-date",data[0].createdDate),$("#messagesTab").is(":visible")||lastMessageSeen&&!(new Date(data[0].createdDate)>new Date(lastMessageSeen))?PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameLastMessageSeen,data[0].createdDate):($("#messagesTabHeader").find(".ui-message-tab-logo").removeClass("fa-blink").addClass("fa-blink"),$("#messagesTabHeader").click());for(var i in data){var msg=$('<div class="list-group-item"><h4 class="list-group-item-heading"></h4><p class="list-group-item-text" style="white-space:pre-wrap"></p><div style="text-align:right"><small class="text-muted " /></div></div>');msg.find(".list-group-item-heading").text(data[i].title);var description=data[i].descriptionV2;data[i].ctaLabel&&data[i].ctaURL&&(description=description.replace("[CALLTOACTION]",'<div class="text-center"><a class="btn btn-xs btn-'+data[i].type+'" href="'+data[i].ctaURL+'" target="_blank">'+data[i].ctaLabel+"</a></div>")),msg.find(".list-group-item-text").append("<span>"+description+"</span>"),msg.find(".list-group-item-text").find("a").each(function(){$(this).attr("target","_blank")}),msg.find(".list-group-item-heading").find("a").each(function(){$(this).attr("target","_blank")}),msg.find("small").text("- "+data[i].createdDate),msg.addClass("list-group-item-"+data[i].type),$("#messagesList").append(msg)}})):void $("#messagesList").find(".list-group-item").append($("<span>"+chrome.i18n.getMessage("popup_messages_nomessage")+"</span>"))});var windowKeyHandler=function(){$(window).on("keydown",function(e){114===e.keyCode||(!_isOSX&&e.ctrlKey||_isOSX&&e.metaKey)&&70===e.keyCode?(e.preventDefault(),$(".ui-quick-search").focus()):!!_shortcuts.sc1.alt==!!e.altKey&&!!_shortcuts.sc1.ctrl==!!e.ctrlKey&&!!_shortcuts.sc1.cmd==!!e.metaKey&&!!_shortcuts.sc1.shift==!!e.shiftKey&&_shortcuts.sc1.key===e.keyCode?(e.preventDefault(),$("#openOrgsTabHeader").trigger("click")):!!_shortcuts.sc2.alt==!!e.altKey&&!!_shortcuts.sc2.ctrl==!!e.ctrlKey&&!!_shortcuts.sc2.cmd==!!e.metaKey&&!!_shortcuts.sc2.shift==!!e.shiftKey&&_shortcuts.sc2.key===e.keyCode?(e.preventDefault(),$("#accountsTabHeader").trigger("click")):!!_shortcuts.sc3.alt===e.altKey&&!!_shortcuts.sc3.ctrl===e.ctrlKey&&!!_shortcuts.sc3.cmd===e.metaKey&&!!_shortcuts.sc3.shift==!!e.shiftKey&&_shortcuts.sc3.key===e.keyCode&&(e.preventDefault(),$("#accountsTabHeader").trigger("click"),$("#newAccountBtn").trigger("click"))})};loadFromSyncStorage(function(){windowKeyHandler(),init()})})}),global.true=exports}({},function(){return this}());