/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){!function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("codemirror")):"function"==typeof define&&define.amd?define("codemirror-soql-hint",["codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var WORD=/[\*?\w$]+/,KEYWORDS=["SELECT","FROM","TYPEOF","WHERE","ORDER BY","COUNT","OFFSET","LIMIT","MIN()","MAX()","HAVING()","FOR","GROUP BY","GROUPING()","WITH","DATA CATEGORY","ROLLUP","CUBE","ASC","DESC","NULLS FIRST","NULLS LAST","THEN","FOR VIEW","FOR REFERENCE","FOR UPDATE","UPDATE TRACKING","UPDATE VIEWSTAT","USING SCOPE","ABOVE","AVG()","COUNT()","COUNT_DISTINCT()","MIN()","MAX()","SUM()","CALENDAR_MONTH()","CALENDAR_QUARTER()","CALENDAR_YEAR()","DAY_IN_MONTH()","DAY_IN_WEEK()","DAY_IN_YEAR()","DAY_ONLY()","FISCAL_MONTH()","FISCAL_QUARTER()","FISCAL_YEAR()","HOUR_IN_DAY()","WEEK_IN_MONTH()","WEEK_IN_YEAR()","convertTimezone()","FORMAT()","convertCurrency()"],OPERATORS=["IN()","NOT","LIKE","AND","OR","INCLUDES()","EXCLUDES()"],CONSTANTS=["null","TRUE","FALSE","YESTERDAY","TODAY","TOMORROW","LAST_WEEK","THIS_WEEK","NEXT_WEEK","LAST_MONTH","THIS_MONTH","NEXT_MONTH","LAST_90_DAYS","NEXT_90_DAYS","LAST_N_DAYS:n","NEXT_N_DAYS:n","NEXT_N_WEEKS:n","LAST_N_WEEKS:n","NEXT_N_MONTHS:n","LAST_N_MONTHS:n","THIS_QUARTER","LAST_QUARTER","NEXT_QUARTER","NEXT_N_QUARTERS:n","LAST_N_QUARTERS:n","THIS_YEAR","LAST_YEAR","NEXT_YEAR","NEXT_N_YEARS:n","LAST_N_YEARS:n","THIS_FISCAL_QUARTER","LAST_FISCAL_QUARTER","NEXT_FISCAL_QUARTER","NEXT_N_FISCAL_​QUARTERS:n","LAST_N_FISCAL_​QUARTERS:n","THIS_FISCAL_YEAR","LAST_FISCAL_YEAR","NEXT_FISCAL_YEAR","NEXT_N_FISCAL_​YEARS:n","LAST_N_FISCAL_​YEARS:n","YYYY-MM-DDTHH:MM:SSZ"];CodeMirror.registerHelper("hint","soql-hint",function(editor,options){for(var LOCAL_KEYWORDS=JSON.parse(JSON.stringify(KEYWORDS)),LOCAL_OPERATORS=JSON.parse(JSON.stringify(OPERATORS)),LOCAL_CONSTANTS=JSON.parse(JSON.stringify(CONSTANTS)),word=options&&options.word||WORD,cur=editor.getCursor(),curLine=editor.getLine(cur.line),end=cur.ch,start=end;start&&word.test(curLine.charAt(start-1));)--start;var curWord=start!=end&&curLine.slice(start,end);curWord||(curWord="");var list=[],selectedObjectName="",selectSubqueryObjectName="",relationShip="",$client=options._sfclient;if(!$client||!options._describe)return resolve({list:[{text:"",displayText:"Describing org...Retry later..."}],from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)});for(var promiseObjects=function(){return new Promise(function(resolve,reject){if(options._describe){for(var key in options._describe)options._describe.hasOwnProperty(key)&&key.toLowerCase().indexOf(curWord.toLowerCase())>=0&&list.push({text:key,displayText:key,className:"codemirror-hint-object"});return list.sort(function(a,b){return(a.text||"").toLowerCase()<(b.text||"").toLowerCase()?-1:(a.text||"").toLowerCase()>(b.text||"").toLowerCase()?1:0}),resolve({list:list,from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)})}list=[{text:"",displayText:"Describing org...Retry later..."}]})},promiseChildRels=function(){return new Promise(function(resolve,reject){var apiName;for(var key in options._describe)if(options._describe.hasOwnProperty(key)&&key.toLowerCase()===selectedObjectName.toLowerCase()){apiName=key;break}if(!apiName)throw new Error("Invalid API Name "+selectedObjectName);return selectedObjectName=apiName,$client.describeObjectByKeyOrName(null,selectedObjectName,!0,function(err,objDescribe){if(err)console.log(err),list=[{text:"",displayText:""+err}];else{var list=[];for(var key in objDescribe.childRelationships)if(objDescribe.childRelationships.hasOwnProperty(key)&&key.toLowerCase().indexOf(curWord.toLowerCase())>=0){var fieldDescribe=objDescribe.childRelationships[key];list.push({text:key,displayText:key+" ("+objDescribe.name+", ref. "+fieldDescribe.childSObject+")",className:"codemirror-hint-object"})}list.sort(function(a,b){return(a.text||"").trim().toLowerCase()<(b.text||"").trim().toLowerCase()?-1:(a.text||"").trim().toLowerCase()>(b.text||"").trim().toLowerCase()?1:0})}return resolve({list:list,from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)})})})},promiseFields=function(selectedObjectName,selectSubqueryObjectName,relationShipChain){return new Promise(function(resolve,reject){var apiName;for(var key in options._describe)if(options._describe.hasOwnProperty(key)&&key.toLowerCase()===selectedObjectName.toLowerCase()){apiName=key;break}return apiName?(selectedObjectName=apiName,$client.describeObjectByKeyOrName(null,selectedObjectName,!0,function(err,mainObjectDescr){if(!err){var objName=selectedObjectName;if(selectSubqueryObjectName){var childRelationship;for(var keyrel in mainObjectDescr.childRelationships)if(mainObjectDescr.childRelationships.hasOwnProperty(keyrel)&&keyrel.toLowerCase()===selectSubqueryObjectName.toLowerCase()){childRelationship=mainObjectDescr.childRelationships[selectSubqueryObjectName];break}if(!childRelationship)throw new Error("Invalid Relation Name "+selectSubqueryObjectName);objName=childRelationship.childSObject}return $client.describeObjectByKeyOrName(null,objName,!0,function(err,objDescribe){if(err)console.log(err),list=[{text:"",displayText:""+err}];else{if(relationShipChain){var split=relationShipChain.split("."),relName=split.splice(0,1)[0];relationShipChain=split.join(".");for(var key in objDescribe.fields)if(objDescribe.fields.hasOwnProperty(key)){var fieldDescribe=objDescribe.fields[key];if(fieldDescribe.relationshipName&&fieldDescribe.relationshipName.toLowerCase().indexOf(relName.toLowerCase())>=0&&fieldDescribe.referenceTo&&1===fieldDescribe.referenceTo.length)return promiseFields(fieldDescribe.referenceTo[0],null,relationShipChain).then(function(result){return resolve(result)})}return resolve({list:[],from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)})}var list=[],allStandardFields=[],allCustomFields=[],allFields=[];for(var key in objDescribe.fields)if(objDescribe.fields.hasOwnProperty(key)){var fieldDescribe=objDescribe.fields[key];allFields.push(fieldDescribe.name),fieldDescribe.custom?allCustomFields.push(fieldDescribe.name):allStandardFields.push(fieldDescribe.name),key.toLowerCase().indexOf(curWord.toLowerCase())>=0&&(list.push({text:key,displayText:key+" ("+objDescribe.name+", "+fieldDescribe.type+")",className:"codemirror-hint-field"}),fieldDescribe.relationshipName&&fieldDescribe.relationshipName.toLowerCase().indexOf(curWord.toLowerCase())>=0&&list.push({text:fieldDescribe.relationshipName+".",displayText:fieldDescribe.relationshipName+" ("+objDescribe.name+", ref. "+fieldDescribe.referenceTo+")",className:"codemirror-hint-relation"}))}allFields.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0}),allStandardFields.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0}),allCustomFields.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0});for(var i=0;i<LOCAL_KEYWORDS.length;i++)LOCAL_KEYWORDS[i].toLowerCase().indexOf(curWord.toLowerCase())>=0&&list.push({text:LOCAL_KEYWORDS[i],displayText:LOCAL_KEYWORDS[i],className:"codemirror-hint-keyword"});for(var i=0;i<LOCAL_OPERATORS.length;i++)LOCAL_OPERATORS[i].toLowerCase().indexOf(curWord.toLowerCase())>=0&&list.push({text:LOCAL_OPERATORS[i],displayText:LOCAL_OPERATORS[i],className:"codemirror-hint-operator"});for(var i=0;i<LOCAL_CONSTANTS.length;i++)LOCAL_CONSTANTS[i].toLowerCase().indexOf(curWord.toLowerCase())>=0&&list.push({text:LOCAL_CONSTANTS[i],displayText:LOCAL_CONSTANTS[i],className:"codemirror-hint-constant"});var serializeFields=function(fieldArray){for(var lines=[],currentLine="",i=0;i<fieldArray.length;i++)currentLine+=fieldArray[i],i<fieldArray.length-1&&(currentLine+=", "),currentLine.length>60&&(lines.push(currentLine),currentLine="");return currentLine&&lines.push(currentLine),lines.join("\n")};"*"===curWord&&list.push({text:serializeFields(allFields),displayText:"All Fields"}),"*"!==curWord&&0!==curWord.indexOf("*c")||list.push({text:serializeFields(allCustomFields),displayText:"All Custom Fields"}),"*"!==curWord&&0!==curWord.indexOf("*s")||list.push({text:serializeFields(allStandardFields),displayText:"All Standard Fields"}),list.sort(function(a,b){return(a.text||"").trim().toLowerCase()<(b.text||"").trim().toLowerCase()?-1:(a.text||"").trim().toLowerCase()>(b.text||"").trim().toLowerCase()?1:0})}return resolve({list:list,from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)})})}console.log(err),list=[{text:"",displayText:""+err}]})):(console.log("Invalid API Name "+selectedObjectName),resolve({list:[],from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}))})},prevContent="",i=0;i<cur.line;i++)prevContent+=editor.getLine(i)+" ";prevContent+=0!=start&&curLine.slice(0,start)||"";for(var nextContent="",i=cur.line+1;i<editor.lineCount();i++)nextContent+=" "+editor.getLine(i);nextContent=(end!=curLine.length&&curLine.slice(end,curLine.length)||"")+nextContent;var getMainObjectName=function(){var FROM_STR=" from ",content=prevContent+curWord+nextContent,nextFrom=content.toLowerCase().lastIndexOf(FROM_STR);if(nextFrom>=0){var objectName=content.substring(nextFrom+FROM_STR.length-1,content.length);return objectName=objectName.trim().split(" ")[0],objectName.replace("(","").replace(")","").replace(",","")}return""},getNextRelName=function(){var FROM_STR=" from ",SELECT_STR="select ",nextFrom=nextContent.toLowerCase().indexOf(FROM_STR),nextSelect=nextContent.toLowerCase().indexOf(SELECT_STR);if(nextFrom>=0&&(nextSelect<0||nextFrom<nextSelect)){var objectName=nextContent.substring(nextFrom+FROM_STR.length-1,nextContent.length);return objectName=objectName.trim().split(" ")[0],objectName.replace("(","").replace(")","").replace(",","")}return""},getPreviousRelationChain=function(){if("."!==prevContent[prevContent.length-1])return"";var split=prevContent.split(" "),relPath=split[split.length-1];return relPath.indexOf(",")>=0?relPath.split(",")[1]:relPath};return selectedObjectName=getMainObjectName(),selectSubqueryObjectName=getNextRelName(),selectedObjectName===selectSubqueryObjectName&&(selectSubqueryObjectName=""),relationShip=getPreviousRelationChain(),prevContent.trim().toLowerCase().endsWith("from")?(LOCAL_KEYWORDS=[],LOCAL_CONSTANTS=[],LOCAL_OPERATORS=[],nextContent.toLowerCase().indexOf(" from ")>=0?promiseChildRels():promiseObjects()):selectedObjectName?(relationShip&&(LOCAL_KEYWORDS=[],LOCAL_CONSTANTS=[],LOCAL_OPERATORS=[]),promiseFields(selectedObjectName,selectSubqueryObjectName,relationShip)):prevContent||nextContent?void 0:{list:[{text:"SELECT Id From "}],from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}})}),global.true=exports}({},function(){return this}());