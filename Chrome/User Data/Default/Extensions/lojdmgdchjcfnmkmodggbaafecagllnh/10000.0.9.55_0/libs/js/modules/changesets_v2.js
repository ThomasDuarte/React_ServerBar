/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){define("change-set-v2",["global","constants","jquery","popup-utils","salesforce-client","jquery-ui"],function($G,$C,$,PopupUtils,$SalesforceClient){"use sctrict";function drawSelectedComponentsTable(){_recapContent.html('<div class="ui-changeset-main-recap"></div>');var types={},count=0;for(var key in _itemsToBeAdded)if(_itemsToBeAdded.hasOwnProperty(key)){var t=_itemsToBeAdded[key].metadataType;types[t]||(types[t]=[]),types[t].push(_itemsToBeAdded[key]),count++}$("#_addedCmpCounter").text(count+" elements selected"),debug.log("Selected items:",_itemsToBeAdded),debug.log("types",types),debug.log("count",count);for(var key in types)if(types.hasOwnProperty(key)){var mdd=getEntityDiscoveryCriteria(key),container=$('<div class="ui-changeset-recap-container" style=""><div class="ui-changeset-recap-header"><strong>'+mdd.label+'</strong></div><div class="ui-changeset-recap-body"></div></div>');drawComponentsList(mdd,types[key],!0,container.find(".ui-changeset-recap-body")),_recapContent.append(container)}}var $sfclient,window=($G.chrome,$G.window),debug=PopupUtils.newDebugger("ORGanizer: change-set-v2"),handleErrorMessage=function(message){return alert(message)},_enabled=!1,_isLex=!1,_ns=null,_packageId=null,_entityNamesMap={},_currentItems=[],_currentItemsId=[],_itemsToBeAdded={},_mode="REMOVE",_pluginBody=$('<div><br/><hr/><br/><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="pbTitle"><h2 class="mainTitle">Components Manager</h2></td><td class="pbButton ui-changeset-buttons"></td></tr></tbody></table><br/><div class="ui-changeset-header-buttons-top" style="text-align:center"></div><div class="ui-changeset-header"></div><div class="ui-changeset-content" style="height:280px;"></div><br/><hr/><br/><div class="ui-changeset-main-recap"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="pbTitle"><h2 class="mainTitle" id="_addedItemsSct">Items to be added</h2></td></tr></tbody></table><div class="ui-changeset-content-recap"><i>No items selected.</i></div></div><div class="ui-changeset-header-buttons-bottom" style="text-align:center"></div></div>'),_content=_pluginBody.find(".ui-changeset-content"),_recapContent=_pluginBody.find(".ui-changeset-content-recap"),addToChangesetBtn=$('<input class="btn ui-cs-add-btn" type="button" value="Add to Change Set"/>'),addToChangesetAgainBtn=$('<input class="btn ui-cs-add-again-btn" type="button" value="Add to Change Set and add again" />'),cancelBtn=$('<input class="btn ui-cs-cancel-btn" type="button" value="Cancel"/>'),addCheckedItemsIntoForm=function(){var pageForm=$('form[name="editPage"]');pageForm.find("input.ui-changeset-added-item").remove();for(var key in _itemsToBeAdded)if(_itemsToBeAdded.hasOwnProperty(key)){var inputChk=$("<input />");inputChk.attr("id","idsORG"+key).attr("name","ids").addClass("ui-changeset-added-item").attr("type","checkbox").attr("value",key).prop("checked",!0).hide(),pageForm.append(inputChk)}};addToChangesetBtn.click(function(){return addCheckedItemsIntoForm(),$("#editPage input.ui-changeset-added-item").length?void $("input[name=save]").attr("disabled",!1).attr("type","submit")[0].click():alert("No item selected.")}),addToChangesetAgainBtn.click(function(){return addCheckedItemsIntoForm(),$("#editPage input.ui-changeset-added-item").length?void $('input[type=button][name="save-again"]').click():alert("No item selected.")}),cancelBtn.click(function(){$('input[type=button][name="cancel"]').click()});var getEntitiesNamesMap=function(){var options=$(document.body).find("#entityType option");if(!options.length)return debug.warn("Something went wrong loading package info: no entity list found. Please reload page to get all working or report a bug. [E03]"),{"Please reload page...":""};var entityMap={};return options.each(function(){entityMap[$(this).text()]=$(this).val()}),entityMap},initPlugin=function(sid,oid,domainAPIUrl,isLex,apiLevel,callback){if(_isLex=isLex,!_enabled){if(_enabled=!0,$sfclient=new $SalesforceClient.Client("https://"+domainAPIUrl,sid,apiLevel||$C.SF_API.LEVEL),_packageId=PopupUtils.getURLParameter("id"),!_packageId||0!==_packageId.indexOf("033"))return handleErrorMessage("Invalid package Id ["+_packageId+"]");debug.log("Package: ",_packageId),_entityNamesMap=getEntitiesNamesMap(),debug.log("Component Types:",_entityNamesMap),_content.append("<h3>Loading package data...</h3>");var buttonsPanel=$("<div/>"),addBtn=$('<input type="button" class="btn" value="Add Mode" />'),removeBtn=$('<input type="button" class="btn" value="Remove Mode" />'),subTitle=$('<div style="margin:10px;"><span id="_itemsSubTitle"></span> <span style="margin-left:40px"><a href="#_addedItemsSct" id="_addedCmpCounter" class="ui-organizer-link"></a></span></div>');return buttonsPanel.append(addBtn).append(removeBtn),_mode="ADD",addBtn.addClass("btnDisabled").attr("disabled",!0).click(function(){subTitle.find("#_itemsSubTitle").html("<strong>Add Components to Change Set</strong>"),addBtn.addClass("btnDisabled ui-organizer-input"),removeBtn.attr("disabled",!1),addBtn.attr("disabled",!0),removeBtn.removeClass("btnDisabled").removeClass("ui-organizer-input"),_mode="ADD",_content.html("<h3>Loading package data...</h3>"),onPackageDataLoaded(),_pluginBody.find("input.ui-cs-add-btn").attr("disabled",!1).removeClass("btnDisabled"),_pluginBody.find("input.ui-cs-add-again-btn").attr("disabled",!1).removeClass("btnDisabled"),_pluginBody.find("input.ui-cs-cancel-btn").attr("value","Cancel")}).click(),removeBtn.click(function(){subTitle.find("#_itemsSubTitle").html("<strong>Remove Components to Change Set</strong>"),addBtn.attr("disabled",!1),removeBtn.attr("disabled",!0),removeBtn.addClass("btnDisabled").addClass("ui-organizer-input"),addBtn.removeClass("btnDisabled").removeClass("ui-organizer-input"),_mode="REMOVE",_content.html("<h3>Loading package data...</h3>"),onPackageDataLoaded(),_pluginBody.find("input.ui-cs-add-btn").attr("disabled",!0).addClass("btnDisabled"),_pluginBody.find("input.ui-cs-add-again-btn").attr("disabled",!0).addClass("btnDisabled"),_pluginBody.find("input.ui-cs-cancel-btn").attr("value","Back")}),_pluginBody.find(".ui-changeset-buttons").append(buttonsPanel),_pluginBody.find(".ui-changeset-header").prepend(subTitle),$sfclient.query(!1,"Select NamespacePrefix From Organization limit 1",function(err,rslt){return!err&&rslt&&(_ns=rslt[0].NamespacePrefix),debug.log("ORG's NamespacePrefix:",_ns),onPackageDataLoaded()}),_pluginBody}},preFilterResults=function(entityDiscoveryCriteria,rslt,callback){for(var i=rslt.length-1;i>=0;i--)if(rslt[i].manageableState&&"unmanaged"!==rslt[i].manageableState)rslt.splice(i,1);else if(entityDiscoveryCriteria.ignoreNS||!rslt[i].NamespacePrefix||rslt[i].NamespacePrefix===_ns){if(entityDiscoveryCriteria.splitParentField){var split=rslt[i][entityDiscoveryCriteria.splitParentField];split||(rslt[i].Name=split,rslt[i].Parent=""),rslt[i].Name=split.split(".")[1],rslt[i].Parent=split.split(".")[0]}}else rslt.splice(i,1);var entityDevName=entityDiscoveryCriteria.api||entityDiscoveryCriteria.name;if(debug.log("Filtering "+entityDevName),"CustomObject"==entityDevName){var isMetadata="Custom Metadata Type"===entityDiscoveryCriteria.name,isCustomSetting="Custom Settings"===entityDiscoveryCriteria.name,isArticleType="Article Type"===entityDiscoveryCriteria.name,isSobject=!(isMetadata||isCustomSetting||isArticleType),finalItems=[];$sfclient.globalDescribe(function(err,gdescr){debug.log("Global Describe: ",gdescr);for(var i=0;i<rslt.length;i++){var key=rslt[i].fullName;gdescr[key]&&(gdescr[key].customSetting&&isCustomSetting||isSobject&&!gdescr[key].customSetting&&gdescr[key].custom&&rslt[i].fullName.indexOf("__kav")<0&&rslt[i].fullName.indexOf("__mdt")<0||isMetadata&&rslt[i].fullName.indexOf("__mdt")>0||isArticleType&&rslt[i].fullName.indexOf("__kav")>0)&&(rslt[i].label=gdescr[key].label,finalItems.push(rslt[i]))}return callback&&callback(null,finalItems)})}else{if("Folder"===entityDevName){for(var i=rslt.length-1;i>=0;i--)rslt[i].DeveloperName||rslt.splice(i,1);return callback&&callback(null,rslt)}if("Translations"===entityDevName)$sfclient.describeObjectByKeyOrName(null,"User",!0,function(err,userDescr){if(err)return debug.error("Describe error: ",err),callback&&callback(null,rslt);debug.log("User describe: ",userDescr);var langPicklist=userDescr.fields.LanguageLocaleKey;if(langPicklist&&langPicklist.picklistValues&&langPicklist.picklistValues.length)for(var i=0;i<rslt.length;i++){rslt[i].DeveloperName=rslt[i].fullName;for(var j=0;j<langPicklist.picklistValues.length;j++)if(langPicklist.picklistValues[j].value===rslt[i].fullName){rslt[i].fullName=langPicklist.picklistValues[j].label,rslt[i].DeveloperName=langPicklist.picklistValues[j].value;break}}return callback&&callback(null,rslt)});else if("ValidationRule"===entityDevName||"AutoResponseRule"===entityDevName||"WebLink"===entityDevName||"Layout"===entityDevName||"WorkflowRule"===entityDevName){if("Layout"===entityDevName)for(var i=rslt.length-1;i>=0;i--)"CaseClose"===rslt[i].TableEnumOrId&&rslt.splice(i,1);for(var objectIds=[],i=0;i<rslt.length;i++){var entityId=rslt[i].EntityDefinitionId||rslt[i].TableEnumOrId;objectIds.indexOf(entityId)<=0&&objectIds.push(entityId)}debug.log("Getting entities: with id:",objectIds),$sfclient.getObjectsByTableEnumOrId(objectIds,function(err,entities){debug.log("Getting entities: ",entities),err?(debug.error("Error getting validation entities: ",err),entities=[]):entities=entities.records||[];for(var entitiesMap={},i=0;i<entities.length;i++)entitiesMap[entities[i].DurableId.substring(0,15)]=entities[i],entitiesMap[entities[i].QualifiedApiName]=entities[i];for(var i=0;i<rslt.length;i++){var entityId=rslt[i].EntityDefinitionId||rslt[i].TableEnumOrId;rslt[i].ParentApiName=(entitiesMap[entityId.substring(0,15)]||{}).QualifiedApiName||(entitiesMap[entityId]||{}).QualifiedApiName||entityId,rslt[i].Parent=(entitiesMap[entityId.substring(0,15)]||{}).Label||(entitiesMap[entityId]||{}).Label||entityId}return callback&&callback(null,rslt)})}else{if("CustomApplication"===entityDevName){for(var i=rslt.length-1;i>=0;i--)debug.log(">>"+rslt[i].fullName),0===rslt[i].fullName.indexOf("standard__")&&rslt.splice(i,1);return callback&&callback(null,rslt)}if("ListView"!==entityDevName)return callback&&callback(null,rslt);$sfclient.listMetadata("ListView",function(err,results){return err?callback&&callback(err):(debug.log("List metadata: ",results),void $sfclient.retrieveMetadataType({ListView:results},function(err,data){if(err)return callback&&callback(err);var ts=1e3,retrieveFnc=function(){ts+=parseInt(ts/2),$sfclient.checkRetrievePackageStatus(data.id,function(err,results){return err?callback&&callback(err):results.done?(debug.log("Iteration",ts,results),PopupUtils.triggerPackageZipRead(results.zip,function(response){if(!response.success)return callback&&callback(response.error);debug.log("Zip file read:",response);var packagedListViews={};for(var filename in response.results)if("package.xml"!==filename&&0===filename.indexOf("objects")&&!(filename.indexOf(".object")<1)){var key=filename.replace("objects/","").replace(".object","");$(response.results[filename]).find("listViews").each(function(){var listname=key+"."+$(this).find("fullName").text(),filterScope=$(this).find("filterScope").text(),label=$(this).find("label").text();packagedListViews[listname]={label:label,fullName:listname,filterScope:filterScope}})}debug.log("Listviews read from zip: ",packagedListViews);for(var i=rslt.length-1;i>=0;i--){var listViewObj=rslt[i];listViewObj.Label=rslt[i].Name;var retrievedListViewObj=packagedListViews[listViewObj.SObjectType+"."+listViewObj.DeveloperName];retrievedListViewObj&&("Queue"!==retrievedListViewObj.filterScope?listViewObj.Label=retrievedListViewObj.label:rslt.splice(i,1))}return rslt.sort(function(a,b){return a&&a.Label?b&&b.Label?a.Label.toLowerCase()<=b.Label.toLowerCase()?-1:a.Label.toLowerCase()>b.Label.toLowerCase()?1:0:1:-1}),callback&&callback(null,rslt)})):(debug.log("Iteration",ts,results),setTimeout(retrieveFnc,ts))})};return retrieveFnc()}))})}}},filterComponentsInPackage=function(rlst,mode){for(var i=rlst.length-1;i>=0;i--){var compId=rlst[i].Id||rlst[i].id;"ADD"===mode?(!compId||_currentItemsId.indexOf(compId.substring(0,15))>=0)&&rlst.splice(i,1):compId&&_currentItemsId.indexOf(compId.substring(0,15))<0&&rlst.splice(i,1)}},getEntityDiscoveryCriteria=function(entityType){debug.log("Selected Entity",entityType);for(var entityDiscoveryCriteria=null,i=0;i<$C.ChangeSetQueryCriteria.length;i++)if($C.ChangeSetQueryCriteria[i].name===entityType){entityDiscoveryCriteria=$C.ChangeSetQueryCriteria[i];break}return!entityDiscoveryCriteria&&entityType.indexOf("__mdt")>0&&(entityDiscoveryCriteria={name:entityType,label:entityType,method:"SOQL",with:"DeveloperName",query:"Select Id, Label, DeveloperName From "+entityType,outputFields:"Label,DeveloperName"}),entityDiscoveryCriteria},loadMetadataItems=function(entityType,callback){var entityDiscoveryCriteria=getEntityDiscoveryCriteria(entityType);if(_content.html("Loading query: "+entityType),!entityDiscoveryCriteria)return callback&&callback(new Error("Cannot determine components list. Use standard changeset items selection (1)."),entityDiscoveryCriteria);var entityDevName=entityDiscoveryCriteria.api||entityDiscoveryCriteria.name;if("Tooling"===entityDiscoveryCriteria.method||"SOQL"===entityDiscoveryCriteria.method){var query="SELECT Id, DeveloperName, LastModifiedDate, LastModifiedBy.Name From "+entityDevName;entityDiscoveryCriteria.query&&(query=entityDiscoveryCriteria.query),entityDiscoveryCriteria.with&&entityDiscoveryCriteria.with&&(query=query.replace("DeveloperName",entityDiscoveryCriteria.with)),query.toLowerCase().indexOf("namespaceprefix")<0&&!entityDiscoveryCriteria.ignoreNS&&(query=query.toLowerCase().split("from")[0]+",NamespacePrefix FROM"+query.toLowerCase().split("from")[1]),debug.log("Query issued: ",query),$sfclient.query("Tooling"===entityDiscoveryCriteria.method,query,function(err,rslt){return err?(debug.error("Error: ",err,query),callback&&callback(new Error("Error retrieving items list. Please retry. (1)"),entityDiscoveryCriteria)):void preFilterResults(entityDiscoveryCriteria,rslt,function(err,filteredRslt){return err?(debug.error("Error: ",err),callback&&callback(new Error("Error retrieving items list. Please retry. (2)"),entityDiscoveryCriteria)):(filterComponentsInPackage(filteredRslt,_mode),debug.log("Items: ",filteredRslt),callback&&callback(null,entityDiscoveryCriteria,filteredRslt))})})}else{if("Metadata"!==entityDiscoveryCriteria.method)return callback&&callback(new Error("Cannot determine components list. Use standard changeset items selection. (2)"),entityDiscoveryCriteria);$sfclient.listMetadata(entityDevName,function(err,rslt){return err?(debug.error("Error: ",err),callback&&callback(new Error("Error retrieving items list. Please retry. (3)"),entityDiscoveryCriteria)):void preFilterResults(entityDiscoveryCriteria,rslt,function(err,filteredRslt){return err?(debug.error("Error: ",err),callback&&callback(new Error("Error retrieving items list. Please retry. (4)"),entityDiscoveryCriteria)):(filterComponentsInPackage(filteredRslt,_mode),debug.log("Items: ",filteredRslt),callback&&callback(null,entityDiscoveryCriteria,filteredRslt))})})}},drawComponentsList=function(entityMetadata,results,isAddRecap,recapEl){function createInput(item){var input=$("<input />");return input.attr("id","selected_idsORG"+componentId).attr("name","ids").attr("type","checkbox").attr("data-redraw-table","true").attr("value",componentId).on("click",function(){var cmpId=$(this).attr("value"),isChecked=$(this).is(":checked");isChecked?isChecked&&(_itemsToBeAdded[cmpId]=item):delete _itemsToBeAdded[cmpId],"true"==$(this).attr("data-redraw-table")&&drawSelectedComponentsTable()}),input}var table=$('<table class="list ui-changeset-components" border="0" cellpadding="0" cellspacing="0"><colgroup span="11"></colgroup>'),tbody=$("<tbody></tbody>"),thead=$('<thead class=""><tr class="headerRow"></tr></thead>');table.append(thead).append(tbody);var thead_th='<th class="headerRow" scope="col" colspan="1"></th>',tbody_tr='<tr class="dataRow even  first" onmouseover="if (window.hiOn){hiOn(this);} " onmouseout="if (window.hiOff){hiOff(this);} " onblur="if (window.hiOff){hiOff(this);}" onfocus="if (window.hiOn){hiOn(this);}"></tr>',tbody_td='<td class="dataCell"></td>';if(thead.find("tr").append('<th class="ui-action"/>'),entityMetadata&&results){for(var fields=entityMetadata.outputFields?entityMetadata.outputFields.split(/\s*,\s*/):entityMetadata.with?[entityMetadata.with]:["DeveloperName"],i=0;i<fields.length;i++){var lbl=fields[i];"lastModifiedDate"===lbl?lbl="LastModifiedDate":"lastModifiedByName"===lbl&&(lbl="LastModifiedBy.Name");var th=$(thead_th).html(lbl).attr("data-field",fields[i]);thead.find("tr").append(th)}var inputAll=$("<input />");inputAll.attr("type","checkbox").on("click",function(){var isChecked=$(this).is(":checked");tbody.find('input[type="checkbox"]').each(function(){$(this).is(":visible")&&$(this).is(":checked")!=isChecked&&$(this).attr("data-redraw-table","false").trigger("click").attr("data-redraw-table","true")}),drawSelectedComponentsTable()}),"ADD"!==_mode||isAddRecap||thead.find("tr .ui-action").append(inputAll);for(var ci=0;ci<results.length;ci++){var item=results[ci],componentId=item.id||item.Id,tr=$(tbody_tr);tr.attr("data-component-id",componentId),tbody.append(tr);var tdAction=$('<td class="ui-action"/>');if(tr.append(tdAction),isAddRecap){var removeLink=$("<a>Remove from add list</a>").addClass("actionLink ui-pointer ui-remove-component-lnk").attr("data-component-id",componentId).click(function(){var cmpId=$(this).attr("data-component-id");delete _itemsToBeAdded[cmpId],_pluginBody.find("input#selected_idsORG"+cmpId).prop("checked",!1);var containingTable=$(this).closest("table");$(this).closest("tr").remove(),containingTable.find("tbody tr").length||containingTable.closest(".ui-changeset-recap-container").remove()});tdAction.append(removeLink)}else if("ADD"===_mode){var input=createInput(item);_itemsToBeAdded[componentId]&&input.prop("checked",!0),tdAction.append(input)}else{var removeLink=$("<a>Remove</a>").addClass("actionLink ui-pointer ui-remove-component-lnk").attr("data-component-id",componentId).click(function(){var currentRemoveLink=$(this);$(this).html("Loading...").removeClass("ui-pointer").removeClass("actionLink").unbind("click");var compId=$(this).attr("data-component-id");$.ajax({type:"GET",cache:!1,timeout:12e4,url:"/"+_packageId,success:function(data,textStatus,request){var remove=$(data).find('[id="'+compId.substring(0,15)+':componentName"]').parent().find("td.actionColumn a");$.ajax({type:"GET",cache:!1,timeout:12e4,url:remove.attr("href"),success:function(data,textStatus,request){currentRemoveLink.parent().parent().remove()},error:function(e){throw new Error("Unexpected error deleting component: "+e)}})},error:function(e){throw new Error("Unexpected error deleting component: "+e)}})});tdAction.append(removeLink)}for(var i=0;i<fields.length;i++){var td=$(tbody_td);tr.append(td);var value=item[fields[i]];"lastModifiedDate"===fields[i]||"LastModifiedDate"===fields[i]?value=new Date(value).toLocaleString():"LastModifiedBy.Name"===fields[i]&&(value=(item.LastModifiedBy||{}).Name),td.html(value)}tr.attr("data-text",tr.text().toLowerCase())}}if(!results||!results.length){var tr=$(tbody_tr),tdAction=$('<td class="ui-action"/>');tr.append(tdAction);var td=$(tbody_td);tr.append(td),tbody.append(tr),td.html("There are no remaining components of the selected type available to add to your change set.")}var tableDiv=$("<div/>").append(table);isAddRecap||tableDiv.attr("style","height:250px;overflow:auto; width: 100%");var pageBlock=$('<div class="pbBody"/>');pageBlock.append(tableDiv),isAddRecap?recapEl&&recapEl.html("").append(pageBlock):_content.html("").append(pageBlock);var entityLabelDiv=$('<span>Selected: <span class="ui-organizer-link"/></span>');entityLabelDiv.find(".ui-organizer-link").text(entityMetadata.localLabel),pageBlock.prepend(entityLabelDiv)},onPackageDataLoaded=function(){"https://"+window.location.hostname+"/"+_packageId;queryPackage(_packageId,function(err,itemsId,items){if(err)return void debug.error("ORGanizer - Something went wrong: ",error);_currentItems=items,_currentItemsId=itemsId,debug.log("Components:",_currentItems);var slct=_pluginBody.find("input.ui-changeset-component-select"),fieldset=_pluginBody.find("datalist.ui-changeset-component-select");if(!slct.length){slct=$('<input class="ui-changeset-component-select" list="org-ui-comp-list" placeholder="Search components..."/>'),fieldset=$('<datalist id="org-ui-comp-list" class="ui-changeset-component-select"/>'),_pluginBody.find(".ui-changeset-header").append("<label>Component Type: </label>").append(slct).append(fieldset);for(var et in _entityNamesMap)_entityNamesMap.hasOwnProperty(et)&&fieldset.append($("<option/>").attr("data-value",_entityNamesMap[et]).val(et));slct.val($("#entityType option:selected").text()),slct.on("change",function(){$("#editPage").find("input.ui-changeset-added-item").remove();var value=fieldset.find('option[value="'+$(this).val()+'"]').attr("data-value"),localLabel=$(this).val();return loadMetadataItems(value,function(err,mdd,rslt){if(err)return _content.html("<br/><br/><strong>Unexpected error loading components:</strong><br/> "+err),void(rslt=[]);debug.log("Items filtered callback: ",err,mdd,rslt),inputSearch&&inputSearch.val("");for(var i=0;i<rslt.length;i++)rslt[i].metadataType=mdd.name;return mdd.localLabel=localLabel,drawComponentsList(mdd,rslt)})})}slct.trigger("change");var inputSearch=_pluginBody.find("input.ui-changeset-filter");inputSearch.length||(inputSearch=$("<input />").attr("type","text").addClass("ui-changeset-filter").css("width","200px").css("margin-left","30px").attr("title","Quick filter components list (current page)  - ORGanizer Changeset Helper").attr("placeholder","Quick search components..."),_pluginBody.find(".ui-changeset-header").append(inputSearch),inputSearch.on("keyup",function(){var table=_pluginBody.find("table.ui-changeset-components"),searchText=inputSearch.val().toLowerCase();table.find("tbody tr").each(function(){var tr=$(this),trText=tr.attr("data-text");trText.indexOf(searchText)>=0?tr.css({display:""}):tr.css({display:"none"})})}),_pluginBody.find(".ui-changeset-header-buttons-top").append(addToChangesetBtn).append(addToChangesetAgainBtn).append(cancelBtn),_pluginBody.find(".ui-changeset-header-buttons-bottom").append(addToChangesetBtn.clone().click(function(){addToChangesetBtn.click()})).append(addToChangesetAgainBtn.clone().click(function(){addToChangesetAgainBtn.click()})).append(cancelBtn.clone().click(function(){cancelBtn.click()})))})},queryPackage=function(packageId,callback){var url="https://"+window.location.hostname+"/"+packageId;$.ajax({type:"GET",cache:!1,timeout:6e4,url:url,success:function(data,textStatus,request){var doc=$(data);debug.log("Getting all compoments...");var componentTable=doc.find('[id="ViewAllPackage:theForm::packageComponentTable"]'),formCheck=doc.find('form[id="ViewAllPackage:theForm"]');formCheck.length||(handleErrorMessage('Cannot get package items list. This may be due to corrupted package/changeset.\nA new page is about to open: click on the "Recompile All" button, wait till the completion, close the tab and then refresh this page.'),window.open(url));var items=[],itemsId=[];componentTable.find("tbody tr").each(function(){var tdId=$(this).find('td[id$="componentName"]'),componentId=tdId.attr("id").split(":")[0],componentName=tdId.text().trim().replace(/\s+/g," "),parent=tdId.next().text().trim().replace(/\s+/g," "),componentTypeLabel=tdId.next().next().text().trim().replace(/\s+/g," "),componentTypeApiName=_entityNamesMap[componentTypeLabel],tdAction=$(this).find(".actionColumn");itemsId.push(componentId),items.push({id:componentId,type:{name:componentTypeApiName,label:componentTypeLabel},name:componentName,parent:parent,link:tdId.find("a").attr("href"),removeLink:tdAction.find("a").attr("href"),labelType:componentTypeLabel,apiName:componentName})}),callback(null,itemsId,items)},error:function(xhr,status,error){return debug.error("ORGanizer - Something went wrong: ",xhr.responseText,status,error),callback&&callback(error)}})};return{render:initPlugin,queryPackage:queryPackage}}),global.true=exports}({},function(){return this}());