/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){define("formula-editor",["global","constants","jquery","popup-utils","salesforce-client","codemirror","codemirror-show-hint","codemirror-sql","codemirror-formula-hint"],function($G,$C,$,PopupUtils,$SalesforceClient,CodeMirror){"use sctrict";var setCursorPosition=($G.chrome,$G.window,function(mainElement,pos){return mainElement.each(function(index,elem){if(elem.setSelectionRange)elem.setSelectionRange(pos,pos);else if(elem.createTextRange){var range=elem.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}),this}),enableFormulaEditor=function(options){try{return $(".FormulaText").each(function(){if($(this).is(":visible")){var textarea=$(this).get(0),width=$(this).width(),editor=CodeMirror.fromTextArea(textarea,{mode:"text/x-mariadb",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,indentUnit:parseInt((options||{}).TAB_SIZE||2),tabSize:1,hintOptions:{completeSingle:!1,hint:CodeMirror.hint["formula-hint"]}});editor.setOption("extraKeys",{Tab:function(cm){var spaces=Array(cm.getOption("indentUnit")+1).join(" ");cm.replaceSelection(spaces)},"Ctrl-I":function(cm){for(var i=0;i<cm.lineCount();i++)cm.indentLine(i)},"Ctrl-Space":"autocomplete"}),$(editor.getWrapperElement()).addClass("bnsn").width(width);var cursorDiv=$('<div class="bnsn"><div class="ui-textarea-footer text-left text-muted" style="font-size:9pt;display:inline; font-family:monospace; margin-left:30px;"><a class="ui-organizer-link" style="color: gray;" target="_blank" href="'+$C.Endpoints.FAQPage+'#formula">ORGanizer for Salesforce Enhanced Formula Editor</a></div><div class="ui-textarea-footer pull-right text-muted" style=" font-family:monospace; display:inline">Line: <span class="ui-cm-line"></span> Column: <span class="ui-cm-column"></span></div></div>');$(textarea).next().after(cursorDiv),cursorDiv.width(width);var updateCursorCoordinates=function(edt){cursorDiv.find(".ui-cm-column").html(edt.getCursor().ch+1),cursorDiv.find(".ui-cm-line").html(edt.getCursor().line+1)};editor.on("cursorActivity",function(edt){updateCursorCoordinates(edt)}),updateCursorCoordinates(editor),$(editor.getWrapperElement()).resizable({resize:function(){console.log(">>>>>>>>>>>>>>>>>>>>>>>>>test"),editor.setSize($(this).width(),$(this).height()),cursorDiv.width($(this).width()),editor.refresh()}});var cpos=null;editor.on("blur",function(){$(textarea).val(editor.getValue()),cpos=editor.getCursor();for(var lineSplit=editor.getValue().split("\n"),cursPositionOnBlur=0,i=0;i<lineSplit.length;i++){if(i===cpos.line){cursPositionOnBlur+=cpos.ch;break}cursPositionOnBlur+=lineSplit[i].length+1}setCursorPosition($(textarea).focus(),cursPositionOnBlur)});var prevValue=$(textarea).val();setInterval(function(){if($(textarea).val()!=prevValue){var diff=$(textarea).val().length-prevValue.length;prevValue=$(textarea).val(),editor.setValue(prevValue),editor.focus(),cpos&&editor.setCursor(cpos.line,cpos.ch+diff)}},100),editor.refresh()}}),!0}catch(ex){console.log("error",ex)}};return{apply:function(options){enableFormulaEditor(options||{}),$("#FilterType").on("change",function(){return enableFormulaEditor(options||{})})}}}),global.true=exports}({},function(){return this}());