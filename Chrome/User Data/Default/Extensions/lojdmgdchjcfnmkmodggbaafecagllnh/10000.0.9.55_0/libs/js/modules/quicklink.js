/* ORGanizer for Salesforce - v10000.0.9.53 
 * Author: Enrico Murru (https://organizer.solutions/)
 * Copyright 2016-2024
 */
!function(exports,global){define("quicklink",["global","constants","jquery","popup-utils","salesforce-client","licensing-utils","typeahead"],function($G,$C,$,PopupUtils,$SalesforceClient,$LicUtils){"use sctrict";function resetFormatting(v){return $("<span/>").html($("<span/>").text(v).html().replace(/\[_b_\]/gi,"<b>").replace(/\[_\/b_\]/gi,"</b>")).html()}var $sfclient,typeaheadCmp,COMMAND_CHAR="@",debug=PopupUtils.newDebugger("ORGanizer: quicklink"),chrome=$G.chrome,window=$G.window,_lockRemove=!1,_orgid=null,_serverName=null,_pinConfiguration=null,_sid=null,_domainAPI=null,_pluginConfiguration=null,_freezeUI=!1,_myDomain=null,_metadataObjects=[],inputPlaceholder="",currentCommand="",currentSubcommand="",getEntityDiscoveryCriteria=function(entityType){debug.log("Selected Entity",entityType),$C.ChangeSetQueryCriteria.push({name:"Profile",label:"Profiles",method:"SOQL",with:"Name",query:"Select Id,Name From Profile",outputFields:"Name",ignoreNS:!0});for(var entityDiscoveryCriteria=null,i=0;i<$C.ChangeSetQueryCriteria.length;i++)if($C.ChangeSetQueryCriteria[i].name===entityType){entityDiscoveryCriteria=$C.ChangeSetQueryCriteria[i];break}return!entityDiscoveryCriteria&&entityType.indexOf("__mdt")>0&&(entityDiscoveryCriteria={name:entityType,label:entityType,method:"SOQL",with:"DeveloperName"}),entityDiscoveryCriteria},loadMetadataItems=function(entityType,callback){var entityDiscoveryCriteria=getEntityDiscoveryCriteria(entityType);if(debug.log("entityDiscoveryCriteria",entityDiscoveryCriteria),!entityDiscoveryCriteria)return callback&&callback(new Error("Cannot determine components list. Use standard items selection."),entityDiscoveryCriteria);var entityDevName=entityDiscoveryCriteria.api||entityDiscoveryCriteria.name;if(debug.log("entityDevName",entityDevName),"Tooling"===entityDiscoveryCriteria.method||"SOQL"===entityDiscoveryCriteria.method){var query="SELECT Id, DeveloperName From "+entityDevName;entityDiscoveryCriteria.query&&(query=entityDiscoveryCriteria.query),entityDiscoveryCriteria.with&&entityDiscoveryCriteria.with&&(query=query.replace("DeveloperName",entityDiscoveryCriteria.with)),query.toLowerCase().indexOf("namespaceprefix")<0&&!entityDiscoveryCriteria.ignoreNS&&(query=query.toLowerCase().split("from")[0]+",NamespacePrefix FROM"+query.toLowerCase().split("from")[1]),debug.log("Query issued: ",query),$sfclient.query("Tooling"===entityDiscoveryCriteria.method,query,function(err,rslt){return err?(debug.error("Error: ",err,query),callback&&callback(new Error("Error retrieving items list. Please retry."),entityDiscoveryCriteria)):callback&&callback(null,entityDiscoveryCriteria,rslt)})}else{if("Metadata"!==entityDiscoveryCriteria.method)return callback&&callback(new Error("Cannot determine components list. Use standard items selection."),entityDiscoveryCriteria);$sfclient.listMetadata(entityDevName,function(err,rslt){return err?(debug.error("Error: ",err),callback&&callback(new Error("Error retrieving items list. Please retry."),entityDiscoveryCriteria)):callback&&callback(null,entityDiscoveryCriteria,rslt)})}},ACTIONS={saveQuicklink:function(command){if(!command._param0)return!1;var ql={l:command._param0,p:getCurrentPagePath()};return PopupUtils.addQuickLink(_orgid,_serverName,ql,function(err){if(err)throw err}),!0},addHistoryLink:function(command){var ql={l:command._param0,p:getCurrentPagePath(),d:(new Date).getTime()};return PopupUtils.addItemInHistory(_orgid,ql,function(err){if(err)throw err}),!0}},queryMetadataComponents=function(){if(!currentSubcommand)return _metadataObjects=[];var entityType=null,curSubCom=currentSubcommand;return curSubCom==COMMAND_CHAR+"classes"?entityType="ApexClass":curSubCom==COMMAND_CHAR+"triggers"?entityType="ApexTrigger":curSubCom==COMMAND_CHAR+"pages"?entityType="ApexPage":curSubCom==COMMAND_CHAR+"components"?entityType="ApexComponent":curSubCom==COMMAND_CHAR+"labels"?entityType="ExternalString":curSubCom==COMMAND_CHAR+"static resources"?entityType="StaticResource":curSubCom==COMMAND_CHAR+"workflow rules"?entityType="WorkflowRule":curSubCom==COMMAND_CHAR+"validation rules"?entityType="ValidationFormula":curSubCom==COMMAND_CHAR+"flows"?entityType="FlowDefinition":curSubCom==COMMAND_CHAR+"profiles"&&(entityType="Profile"),entityType?(debug.log("entityType",entityType),typeaheadCmp.find("input").attr("placeholder","Loading metadata..."),void loadMetadataItems(entityType,function(err,metaInfo,rslt){if(curSubCom!==currentSubcommand)return debug.log("Requested subcommand "+curSubCom+" has changed ("+currentSubcommand+")");var lexURL="";"ApexClass"==entityType?lexURL="/lightning/setup/ApexClasses/page?address=%2F{0}":"ApexTrigger"==entityType?lexURL="/lightning/setup/ApexTriggers/page?address=%2F{0}":"ApexComponent"==entityType?lexURL="/lightning/setup/ApexComponents/page?address=%2F{0}":"ExternalString"==entityType?lexURL="/lightning/setup/ExternalStrings/page?address=%2F{0}":"StaticResource"==entityType?lexURL="/lightning/setup/StaticResources/page?address=%2F{0}":"WorkflowRule"==entityType?lexURL="/lightning/setup/WorkflowRules/page?address=%2F{0}":"ValidationFormula"==entityType?lexURL="/lightning/setup/ObjectManager/{1}/ValidationRules/{0}/view":"Profile"==entityType?lexURL="/lightning/setup/EnhancedProfiles/page?address=%2F{0}":"FlowDefinition"==entityType&&(lexURL="/builder_platform_interaction/flowBuilder.app?flowId={0}"),_metadataObjects=rslt||[];for(var i=0;i<rslt.length;i++)rslt[i].entityType=entityType,rslt[i].lexURL=lexURL,"ExternalString"==entityType?rslt[i].fullName=rslt[i].MasterLabel+" ("+rslt[i].Name+")":"StaticResource"==entityType?rslt[i].fullName=rslt[i].Name:"WorkflowRule"==entityType?rslt[i].fullName=rslt[i].Name+" ("+rslt[i].TableEnumOrId+")":"ValidationFormula"==entityType?(rslt[i].fullName=rslt[i].ValidationName+" ("+rslt[i].EntityDefinitionId+")",rslt[i].lexURL=rslt[i].lexURL.replace("{1}",rslt[i].EntityDefinitionId).replace("{0}",rslt[i].Id)):"Profile"==entityType?rslt[i].fullName=rslt[i].Name:"FlowDefinition"==entityType&&(rslt[i].fullName=rslt[i].DeveloperName,rslt[i].id=rslt[i].Id,rslt[i].forceLex=!0,rslt[i].lexURL=rslt[i].lexURL.replace("{0}",rslt[i].LatestVersionId));debug.log(entityType,rslt),typeaheadCmp.find("input").attr("placeholder",inputPlaceholder),debug.log(err,metaInfo,rslt)})):_metadataObjects=[]},getCurrentPagePath=function(){var currentPagePath=window.location.href;currentPagePath=currentPagePath.split("://")[1]||"";var i=currentPagePath.indexOf("/")||0;return currentPagePath=currentPagePath.substring(i,currentPagePath.length)},COMMANDS=[],resetCommands=function(){COMMANDS=[];var TMP_COMMANDS=[{p:"Quick links",l:COMMAND_CHAR+"links",_id:"links",isCommand:!0,subCommands:[{p:'<span>Add quick link named "<b style="color:red">{0}</b>" for <b style="color:blue;">'+getCurrentPagePath()+"</b></span>",l:COMMAND_CHAR+"add",_param0:"",isCommand:!0,action:"saveQuicklink"}]},{p:"History",l:COMMAND_CHAR+"history",_id:"history",isCommand:!0,subCommands:[{p:"Add current page in history (add an optional item label)",l:COMMAND_CHAR+"add",isCommand:!0,action:"addHistoryLink"}]},{p:"Login to another ORG",l:COMMAND_CHAR+"login",_id:"login",isCommand:!0},{p:"Objects setup",l:COMMAND_CHAR+"objects",_id:"objects",isCommand:!0},{p:"Global search",l:COMMAND_CHAR+"search",_id:"search",isCommand:!0},{p:"Metadata Search",l:COMMAND_CHAR+"meta search",_id:"meta search",isCommand:!0,subCommands:[{p:"Apex Classes",l:COMMAND_CHAR+"classes",isCommand:!0},{p:"Apex Triggers",l:COMMAND_CHAR+"triggers",isCommand:!0},{p:"Visualforce Pages",l:COMMAND_CHAR+"pages",isCommand:!0},{p:"Visualforce Components",l:COMMAND_CHAR+"components",isCommand:!0},{p:"Custom Labels",l:COMMAND_CHAR+"labels",isCommand:!0},{p:"Static Resource",l:COMMAND_CHAR+"static resources",isCommand:!0},{p:"Workflow Rules",l:COMMAND_CHAR+"workflow rules",isCommand:!0},{p:"Flows",l:COMMAND_CHAR+"flows",isCommand:!0},{p:"Validation Rules",l:COMMAND_CHAR+"validation rules",isCommand:!0},{p:"Profiles",l:COMMAND_CHAR+"profiles",isCommand:!0}]},{p:"Help",l:COMMAND_CHAR+"help",_id:"help",isCommand:!0}],order=(_pluginConfiguration||{}).COMMANDS_ORDER||[];if(order&&order.length)for(var i=0;i<order.length;i++)for(var j=0;j<TMP_COMMANDS.length;j++)if(TMP_COMMANDS[j]._id===order[i]){COMMANDS.push(TMP_COMMANDS[j]);break}COMMANDS.length||(COMMANDS=TMP_COMMANDS)};return{render:function(options){function identifyCommand(q){var oldCommand=currentCommand,oldSubcommand=currentSubcommand;if(q=q||"",q.toUpperCase().startsWith(COMMAND_CHAR+"SEARCH"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"search: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"search",currentSubcommand="",_metadataObjects=[];else if(q.toUpperCase().startsWith(COMMAND_CHAR+"LOGIN"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"login: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"login",currentSubcommand="",_metadataObjects=[];else if(q.toUpperCase().startsWith(COMMAND_CHAR+"LINKS"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"links: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"links",currentSubcommand="",_metadataObjects=[];else if(q.toUpperCase().startsWith(COMMAND_CHAR+"OBJECTS"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"objects: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"objects",currentSubcommand="",_metadataObjects=[];else if(q.toUpperCase().startsWith(COMMAND_CHAR+"HELP")){typeaheadCmp.find(".typeahead").typeahead("val",""),q="";var url=chrome.runtime.getURL("orglinks.html?oid="+orgid)+"&lex="+(isLex?"1":"0");window.open(url,"_blank"),currentSubcommand="",_metadataObjects=[]}else if(q.toUpperCase().startsWith(COMMAND_CHAR+"HISTORY"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"history: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"history",currentSubcommand="",_metadataObjects=[];else if(q.toUpperCase().startsWith(COMMAND_CHAR+"META SEARCH"))typeaheadCmp.find(".ui-command-span").text(COMMAND_CHAR+"meta search: "),q="",typeaheadCmp.find(".typeahead").typeahead("val",""),currentCommand=COMMAND_CHAR+"meta search",currentSubcommand="",_metadataObjects=[];else if(currentCommand.toUpperCase().startsWith(COMMAND_CHAR+"META SEARCH")){var searchWhat="";"..."===q?(currentSubcommand="",searchWhat=":",_metadataObjects=[]):(q.toUpperCase().startsWith(COMMAND_CHAR+"CLASSES")||q.toUpperCase().startsWith(COMMAND_CHAR+"TRIGGERS")||q.toUpperCase().startsWith(COMMAND_CHAR+"PAGES")||q.toUpperCase().startsWith(COMMAND_CHAR+"COMPONENTS")||q.toUpperCase().startsWith(COMMAND_CHAR+"LABELS")||q.toUpperCase().startsWith(COMMAND_CHAR+"STATIC RESOURCES")||q.toUpperCase().startsWith(COMMAND_CHAR+"WORKFLOW RULES")||q.toUpperCase().startsWith(COMMAND_CHAR+"VALIDATION RULES")||q.toUpperCase().startsWith(COMMAND_CHAR+"FLOWS")||q.toUpperCase().startsWith(COMMAND_CHAR+"PROFILES"))&&(currentSubcommand=q.toLowerCase(),searchWhat=" ["+q.toLowerCase().replace(COMMAND_CHAR,"")+"]:",debug.log("currentSubcommand",currentSubcommand,"searchWhat",searchWhat),queryMetadataComponents()),searchWhat&&(q="",typeaheadCmp.find(".typeahead").typeahead("val",""),typeaheadCmp.find(".ui-command-span").text((COMMAND_CHAR+"meta search"+searchWhat).replace(/</gi,"&lt;")))}oldCommand===currentCommand&&oldSubcommand===currentSubcommand||PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameCurrentQuicklinkCommand,currentCommand,function(err){PopupUtils.setConfigParameterLocal(PopupUtils.StorageParamNameCurrentQuicklinkSubCommand,currentSubcommand,function(err){})});var paddingLeft=typeaheadCmp.find(".ui-command-span").width();return typeaheadCmp.find("input.ui-quicklink-input").css("padding-left",paddingLeft+30),q}function escapeRegExp(str){return str.replace(/\s+/g,"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var substringMatcher=function(strs,objQLinks,accounts){return function(q,cb){var matches;_tmpGoToManualLinkObj=null,_firstQuickLink=null,matches=[];var openSameWindow=!0,searchAccounts=!1;if(q=q||"",q=q.trim(),q=identifyCommand(q),!q||0!==q.indexOf("#")&&q.indexOf("#")!==q.length-1||(openSameWindow=!1,q=0===q.indexOf("#")?q.substring(1,q.length):q.substring(0,q.length-1)),searchAccounts=!searchAccounts&&currentCommand===COMMAND_CHAR+"login",currentCommand!=COMMAND_CHAR+"history"&&0===q.indexOf("/")){if(q.length>1){var obj={openSameWindow:openSameWindow,l:chrome.i18n.getMessage("content_quicklink_enter_to_open_link"),p:resetFormatting(q),isAccount:!1,link:q};matches.push(obj),_tmpGoToManualLinkObj=obj,_firstQuickLink=obj}q=null}if(q&&currentCommand===COMMAND_CHAR+"search"&&!searchAccounts&&0!=q.indexOf(COMMAND_CHAR+"")){if(q.length){var obj={openSameWindow:openSameWindow,l:chrome.i18n.getMessage("content_quicklink_enter_to_global_search"),p:resetFormatting(q),isAccount:!1,link:PopupUtils.getGlobalSearchLink(isLex,q)};matches.push(obj),_tmpGoToManualLinkObj=obj,_firstQuickLink=obj}q=null}if(!q&&currentCommand===COMMAND_CHAR+"history")for(var i=0;i<historyLinks.length;i++)historyLinks[i].isHistory=!0,historyLinks[i].openSameWindow=openSameWindow,historyLinks[i].isAccount=!1,historyLinks[i].isCommand=!1,matches.push(historyLinks[i]);if(q)if(debug.log("currentCommand",currentCommand),debug.log("currentSubcommand",currentSubcommand),substrRegex=new RegExp(escapeRegExp(q.replace(/>/g,"").replace(/:/g,"")),"i"),0===q.indexOf(COMMAND_CHAR+"")){resetCommands();var _commands=COMMANDS;$.each(_commands,function(i,str){if(str.l.startsWith(currentCommand)&&str.subCommands){var subCommandRegex=new RegExp(escapeRegExp(q.replace(/\s+/g," ").split(" ")[0],"i"));$.each(str.subCommands,function(j,subc){if((!isLex||!subc["no-lex"])&&(isLex||!subc["no-classic"])&&subCommandRegex.test(subc.l.replace(/\s+/g,""))){subc.openSameWindow=openSameWindow,subc.isAccount=!1,_firstQuickLink=subc;var parameters=q.split(/\s+/);parameters.splice(0,1);var param=parameters.length?parameters.join(" "):"insert a name";subc._param0=parameters.length?param:null,subc.p=subc.p.replace("{0}",resetFormatting(param)),matches.push(subc)}})}}),$.each(_commands,function(i,str){if(str.l!==currentCommand&&(substrRegex.test(str.l.replace(/\s+/g,""))||substrRegex.test(str.p))){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,_firstQuickLink||(_firstQuickLink=str),matches.push(str)}})}else if(searchAccounts||currentCommand!==COMMAND_CHAR+"links")if(searchAccounts||currentCommand!==COMMAND_CHAR+"objects")if(searchAccounts||currentCommand!==COMMAND_CHAR+"history")if(currentCommand===COMMAND_CHAR+"login")if(_pinConfiguration)matches.push({isAccount:!0,n:chrome.i18n.getMessage("content_quicklink_pin_expired"),g:chrome.i18n.getMessage("content_quicklink_pin_expired_message"),u:"",isCommand:!0});else{var links=accounts||[];$.each(accounts||[],function(i,acc){acc.nDisplay=null,acc.uDisplay=null;var match=PopupUtils.fuzzySearch(q,acc.n);acc.nDisplay=match.formattedString,acc._score=match.score,match.matches||(match=PopupUtils.fuzzySearch(q,acc.u),acc.uDisplay=match.formattedString,acc._score=match.score),match.matches&&(acc.openSameWindow=openSameWindow,acc.isAccount=0!=q.indexOf(COMMAND_CHAR+""),_firstQuickLink||(_firstQuickLink=acc),matches.push(acc))})}else currentCommand===COMMAND_CHAR+"meta search"&&currentSubcommand&&(debug.log(substrRegex,_metadataObjects),$.each(_metadataObjects||[],function(i,cmp){if(cmp.fullName){var match=PopupUtils.fuzzySearch(q,cmp.fullName);if(match.matches){var metaCmp={l:cmp.fullName,lDisplay:match.formattedString,p:isLex||cmp.forceLex?cmp.lexURL.replace("{0}",cmp.id||cmp.Id):"/"+(cmp.id||cmp.Id),openSameWindow:openSameWindow,_score:match.score};console.log(metaCmp),_firstQuickLink||(_firstQuickLink=metaCmp),matches.push(metaCmp)}}}));else $.each(historyLinks||[],function(i,str){var match=PopupUtils.fuzzySearch(q,str.l);if(str.lDisplay=null,match.matches){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,str.isHistory=!0,_firstQuickLink||(_firstQuickLink=str),str.lDisplay=match.formattedString,str._score=match.score,matches.push(str)}}),$.each(historyLinks||[],function(i,str){var match=PopupUtils.fuzzySearch(q,str.p);if(str.pDisplay=null,match.matches&&matches.indexOf(str)<0){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,str.isHistory=!0,_firstQuickLink||(_firstQuickLink=str),str.pDisplay=match.formattedString,str._score=match.score,matches.push(str)}});else{var links=objQLinks||[];$.each(links||[],function(i,str){var match=PopupUtils.fuzzySearch(q,str.l);if(str.lDisplay=null,match.matches){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,_firstQuickLink||(_firstQuickLink=str),str._score=match.score,str.lDisplay=match.formattedString,matches.push(str)}}),$.each(links||[],function(i,str){var match=PopupUtils.fuzzySearch(q,str.p);if(str.pDisplay=null,match.matches&&matches.indexOf(str)<0){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,_firstQuickLink||(_firstQuickLink=str),str.pDisplay=match.formattedString,str._score=match.score,matches.push(str)}})}else{var links=strs||[];$.each(links,function(i,str){var match=PopupUtils.fuzzySearch(q,str.l);if(str.lDisplay=null,match.matches){if(isLex&&str["no-lex"])return;if(!isLex&&str["no-classic"])return;str.openSameWindow=openSameWindow,str.isAccount=!1,_firstQuickLink||(_firstQuickLink=str),str.lDisplay=match.formattedString,str._score=match.score,matches.push(str)}})}if(matches.sort(function(a,b){if(a.isCustom&&!b.isCustom)return-1;if(!a.isCustom&&b.isCustom)return 1;if(!a._score&&!b._score)return 0;if(!a._score)return 1;if(!b._score)return-1;if(a._score>b._score)return-1;if(b._score>a._score)return 1;if(a.l&&b.l){if(a.l.toLowerCase()<b.l.toLowerCase())return-1;if(a.l.toLowerCase()>b.l.toLowerCase())return 1}return 0}),_freezeUI){var item=$LicUtils.createQuickLinkOverlayItem();matches=[item]}_firstQuickLink=matches&&matches.length?matches[0]:null,cb(matches)}},quickLinks=options.quickLinks,historyLinks=options.historyLinks,objectQuiLinks=options.objectQuicklinks,accounts=options.accounts,isLex=options.isLex,orgid=options.oid,serverName=options.serverName,pinConfiguration=options.pinConfiguration,callback=options.onSelectCallback,pluginConfiguration=options.pluginConfiguration;_sid=options.sid,_apiLevel=options.apiLevel,_domainAPI=options.domainAPI,_orgid=orgid,_myDomain=options.myDomain,_serverName=serverName,_pinConfiguration=pinConfiguration,_pluginConfiguration=pluginConfiguration,_darkMode=options.darkMode,_freezeUI=options.actionsLimitHit||!1,COMMAND_CHAR=options.commandChar||PopupUtils.DefaultShortcuts.quickLinkCommand,currentCommand=currentCommand||options.currentCommand,currentSubcommand=currentSubcommand||options.currentSubcommand,0!==(currentCommand||"").indexOf(COMMAND_CHAR)&&(currentCommand=null,currentSubcommand=null),0!==(currentSubcommand||"").indexOf(COMMAND_CHAR)&&(currentSubcommand=null),resetCommands(),currentCommand||(currentCommand=COMMANDS[0].l),inputPlaceholder="Type "+COMMAND_CHAR+" for all commands...",$sfclient=new $SalesforceClient.Client("https://"+_domainAPI,_sid,_apiLevel||$C.SF_API.LEVEL),typeaheadCmp=$('<div class="bnsn ui-typeahead centered-above-all"><span class="ui-command-span" ></span><input class="typeahead ui-quicklink-input" type="text" /><div class="ui-logo ui-quicklinks-logo" >&nbsp;</div><div class="ui-ext-info"></div></div>'),_darkMode&&typeaheadCmp.addClass("bnsn-dark"),typeaheadCmp.find("input").attr("placeholder",inputPlaceholder),isLex&&typeaheadCmp.find("input").addClass("ui-lightning"),typeaheadCmp.find("input").attr("title",chrome.i18n.getMessage("content_quicklink_input_help"));var cmd=currentCommand,subCmd=currentSubcommand;typeaheadCmp.find(".ui-command-span").html(cmd.replace(/</gi,"&lt;")),cmd&&identifyCommand(cmd),subCmd&&identifyCommand(subCmd),$(document.body).append(typeaheadCmp);var _tmpGoToManualLinkObj=null,_firstQuickLink=null;return typeaheadCmp.find(".typeahead").typeahead({hint:!1,highlight:!1,minLength:0},{name:"quickLinks",display:function(suggestion){var displayString=suggestion.openSameWindow?"":"#";return displayString+=suggestion.isAccount?suggestion.n:suggestion.l||suggestion.p},limit:100,source:substringMatcher(quickLinks,objectQuiLinks,accounts),templates:{suggestion:function(obj){if(obj.isAccount)return"<div><span>"+resetFormatting(obj.nDisplay||obj.n)+" <small>("+$("<span/>").text(obj.g).html()+")</small></span> – <small><u>"+resetFormatting(obj.uDisplay||obj.u)+"</u></small></div>";if(obj.isHistory){var el="<div><span>"+resetFormatting(obj.lDisplay||obj.l)+"</span> – <small><u>"+resetFormatting(obj.pDisplay||obj.p)+"</u></small>";return obj.d&&(el+=' - <small style="font-size:8pt;"><i>'+new Date(obj.d).toISOString().replace("T"," ").split(".")[0]+"</small></i>"),el+="</div>"}return'<div title="'+$("<span>"+obj.p+"</span>").text().replace('"',"'")+'" class="'+(obj.isCustom?"ui-quicklink-custom":"")+'">'+resetFormatting(obj.lDisplay||obj.l)+(obj.l==COMMAND_CHAR+"add"||obj.isCustom||obj.isCommand?" – <small><u>"+(obj.pDisplay||obj.p)+"</u></small>":"")+"</div>"}}}),typeaheadCmp.find(".typeahead").focus().on("typeahead:select",function(ev,selected){var mouseEvent=ev.originalEvent;if(_firstQuickLink=null,!selected.isCommand)return _lockRemove||typeaheadCmp.remove(),callback&&callback(selected,mouseEvent);var q=identifyCommand(selected.l);q||setTimeout(function(){typeaheadCmp.find(".typeahead").typeahead("val","."),typeaheadCmp.find(".typeahead").typeahead("val","")},100)}).on("blur",function(){_lockRemove||typeaheadCmp.remove()}).on("keydown",function(e){if(27===e.keyCode)_lockRemove||typeaheadCmp.remove();else if(13===e.keyCode)if(e.preventDefault(),_firstQuickLink&&_firstQuickLink.isCommand&&_firstQuickLink.action&&ACTIONS[_firstQuickLink.action]&&ACTIONS[_firstQuickLink.action](_firstQuickLink)&&(_lockRemove||typeaheadCmp.remove()),_tmpGoToManualLinkObj&&!_firstQuickLink.isCommand)debug.log("_tmpGoToManualLinkObj",_tmpGoToManualLinkObj),!_tmpGoToManualLinkObj.openSameWindow||e.ctrlKey||e.cmdKey?isLex&&!_tmpGoToManualLinkObj.noHash?window.open(_tmpGoToManualLinkObj.link,"_blank"):window.open(_tmpGoToManualLinkObj.link,"_blank"):isLex&&!_tmpGoToManualLinkObj.noHash?window.location=_tmpGoToManualLinkObj.link:window.location=_tmpGoToManualLinkObj.link,_lockRemove||typeaheadCmp.remove();else{if(_firstQuickLink&&!_firstQuickLink.isCommand)return _lockRemove||typeaheadCmp.remove(),callback&&callback(_firstQuickLink);if(_firstQuickLink&&_firstQuickLink.isCommand){var q=identifyCommand(_firstQuickLink.l);q||setTimeout(function(){typeaheadCmp.find(".typeahead").typeahead("val","."),typeaheadCmp.find(".typeahead").typeahead("val","")},100)}}}),typeaheadCmp}}}),global.true=exports}({},function(){return this}());